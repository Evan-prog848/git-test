import{s as x}from"./request-bgZeUyhp.js";import{_ as Ce,o as xe,b as c,c as V,e,w as t,r as u,i as s,J as ke,I as Z,f as N,l as r,t as d,d as C,n as ee,g as j,F as he,B as Ve,P as I,K as Ne}from"./index-Bc-dwE5O.js";import"./auth-BBsyecEI.js";const Ie={class:"credit-manage"},Te={key:0,class:"credit-info"},ze={key:1,style:{"margin-top":"16px"}},Ue={__name:"CreditManage",setup(Le){const q=s("pending"),T=s(!1),z=s(!1),F=s([]),U=s(1),L=s(10),A=s(0),f=s(""),m=s(null),E=s([]),H=s([]),S=s(!1),D=s(1),$=s(10),J=s(0),P=s(!1),i=s(null),g=s(!1),_=s(!0),y=Ne({remark:""}),te={1:"实物与描述不符",2:"爽约",3:"态度恶劣",4:"其他违规"},k=n=>te[n]||"未知",B=n=>"danger",ae=n=>({0:"待处理",1:"已通过",2:"已驳回"})[n]||"未知",le=n=>({0:"warning",1:"success",2:"info"})[n]||"info",ne=n=>n>=90?"优秀":n>=70?"良好":n>=50?"一般":"较差",oe=n=>n>=90?"success":n>=70?"":n>=50?"warning":"danger",re=n=>n>=70?"text-success":n>=50?"text-warning":"text-danger",h=async()=>{T.value=!0;try{const n=await x.get("/admin/credit/pending",{params:{pageNum:U.value,pageSize:L.value}});F.value=n.data.records||[],A.value=n.data.total||0}catch(n){console.error("获取待处理举报失败:",n)}finally{T.value=!1}},K=async()=>{S.value=!0;try{const n=await x.get("/admin/credit/processed",{params:{pageNum:D.value,pageSize:$.value}});H.value=n.data.records||[],J.value=n.data.total||0}catch(n){console.error("获取已处理举报失败:",n)}finally{S.value=!1}},se=async()=>{if(!f.value){I.warning("请输入用户ID");return}try{const n=await x.get(`/admin/credit/score/${f.value}`),l=await x.get(`/admin/credit/user/${f.value}`);m.value={userId:f.value,score:n.data||100},E.value=l.data.records||[]}catch{I.error("查询失败")}},G=n=>{i.value=n,P.value=!0},ue=n=>{i.value=n,_.value=!0,y.remark="",g.value=!0},de=n=>{i.value=n,_.value=!1,y.remark="",g.value=!0},ie=async()=>{z.value=!0;try{await x.post(`/admin/credit/handle/${i.value.id}`,null,{params:{approved:_.value,remark:y.remark}}),I.success("处理成功"),g.value=!1,h()}catch{I.error("处理失败")}finally{z.value=!1}},pe=n=>{n==="pending"?h():n==="processed"&&K()};return xe(()=>{h()}),(n,l)=>{const o=u("el-table-column"),b=u("el-tag"),v=u("el-button"),M=u("el-table"),O=u("el-pagination"),R=u("el-tab-pane"),Q=u("el-input"),ce=u("el-col"),me=u("el-row"),p=u("el-descriptions-item"),W=u("el-descriptions"),ve=u("el-tabs"),fe=u("el-card"),ge=u("el-image"),X=u("el-dialog"),_e=u("el-form-item"),ye=u("el-form"),Y=ke("loading");return c(),V("div",Ie,[e(fe,null,{header:t(()=>[...l[10]||(l[10]=[C("div",{class:"card-header"},[C("span",null,"信用举报管理")],-1)])]),default:t(()=>[e(ve,{modelValue:q.value,"onUpdate:modelValue":l[5]||(l[5]=a=>q.value=a),onTabChange:pe},{default:t(()=>[e(R,{label:"待处理举报",name:"pending"},{default:t(()=>[Z((c(),N(M,{data:F.value,stripe:""},{default:t(()=>[e(o,{prop:"id",label:"ID",width:"80"}),e(o,{prop:"reporterName",label:"举报人",width:"120"}),e(o,{prop:"reportedName",label:"被举报人",width:"120"}),e(o,{prop:"type",label:"举报类型",width:"120"},{default:t(({row:a})=>[e(b,{type:B(a.type)},{default:t(()=>[r(d(k(a.type)),1)]),_:2},1032,["type"])]),_:1}),e(o,{prop:"description",label:"举报描述","show-overflow-tooltip":""}),e(o,{prop:"createTime",label:"举报时间",width:"180"}),e(o,{label:"操作",width:"200",fixed:"right"},{default:t(({row:a})=>[e(v,{type:"primary",link:"",onClick:w=>G(a)},{default:t(()=>[...l[11]||(l[11]=[r("查看详情",-1)])]),_:1},8,["onClick"]),e(v,{type:"success",link:"",onClick:w=>ue(a)},{default:t(()=>[...l[12]||(l[12]=[r("通过",-1)])]),_:1},8,["onClick"]),e(v,{type:"danger",link:"",onClick:w=>de(a)},{default:t(()=>[...l[13]||(l[13]=[r("驳回",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,T.value]]),e(O,{"current-page":U.value,"onUpdate:currentPage":l[0]||(l[0]=a=>U.value=a),"page-size":L.value,"onUpdate:pageSize":l[1]||(l[1]=a=>L.value=a),total:A.value,layout:"total, prev, pager, next",onCurrentChange:h,style:{"margin-top":"16px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),e(R,{label:"已处理举报",name:"processed"},{default:t(()=>[Z((c(),N(M,{data:H.value,stripe:""},{default:t(()=>[e(o,{prop:"id",label:"ID",width:"80"}),e(o,{prop:"reporterName",label:"举报人",width:"120"}),e(o,{prop:"reportedName",label:"被举报人",width:"120"}),e(o,{prop:"type",label:"举报类型",width:"120"},{default:t(({row:a})=>[e(b,{type:B(a.type)},{default:t(()=>[r(d(k(a.type)),1)]),_:2},1032,["type"])]),_:1}),e(o,{prop:"description",label:"举报描述","show-overflow-tooltip":""}),e(o,{prop:"status",label:"处理结果",width:"100"},{default:t(({row:a})=>[e(b,{type:a.status===1?"success":"info"},{default:t(()=>[r(d(a.status===1?"已通过":"已驳回"),1)]),_:2},1032,["type"])]),_:1}),e(o,{prop:"createTime",label:"举报时间",width:"160"}),e(o,{label:"操作",width:"100",fixed:"right"},{default:t(({row:a})=>[e(v,{type:"primary",link:"",onClick:w=>G(a)},{default:t(()=>[...l[14]||(l[14]=[r("查看详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,S.value]]),e(O,{"current-page":D.value,"onUpdate:currentPage":l[2]||(l[2]=a=>D.value=a),"page-size":$.value,"onUpdate:pageSize":l[3]||(l[3]=a=>$.value=a),total:J.value,layout:"total, prev, pager, next",onCurrentChange:K,style:{"margin-top":"16px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),e(R,{label:"查询用户信用",name:"query"},{default:t(()=>[e(me,{gutter:16,style:{"margin-bottom":"16px"}},{default:t(()=>[e(ce,{span:8},{default:t(()=>[e(Q,{modelValue:f.value,"onUpdate:modelValue":l[4]||(l[4]=a=>f.value=a),placeholder:"输入用户ID",clearable:""},{append:t(()=>[e(v,{onClick:se},{default:t(()=>[...l[15]||(l[15]=[r("查询",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),m.value?(c(),V("div",Te,[e(W,{column:3,border:""},{default:t(()=>[e(p,{label:"用户ID"},{default:t(()=>[r(d(m.value.userId),1)]),_:1}),e(p,{label:"当前信用分"},{default:t(()=>[C("span",{class:ee(re(m.value.score))},d(m.value.score),3)]),_:1}),e(p,{label:"信用等级"},{default:t(()=>[e(b,{type:oe(m.value.score)},{default:t(()=>[r(d(ne(m.value.score)),1)]),_:1},8,["type"])]),_:1})]),_:1}),l[16]||(l[16]=C("h4",{style:{margin:"20px 0 10px"}},"信用记录",-1)),e(M,{data:E.value,stripe:"","max-height":"400"},{default:t(()=>[e(o,{prop:"type",label:"类型",width:"120"},{default:t(({row:a})=>[e(b,{type:B(a.type)},{default:t(()=>[r(d(k(a.type)),1)]),_:2},1032,["type"])]),_:1}),e(o,{prop:"scoreChange",label:"分数变化",width:"100"},{default:t(({row:a})=>[C("span",{class:ee(a.scoreChange>0?"text-success":"text-danger")},d(a.scoreChange>0?"+":"")+d(a.scoreChange),3)]),_:1}),e(o,{prop:"description",label:"描述","show-overflow-tooltip":""}),e(o,{prop:"status",label:"状态",width:"100"},{default:t(({row:a})=>[e(b,{type:le(a.status)},{default:t(()=>[r(d(ae(a.status)),1)]),_:2},1032,["type"])]),_:1}),e(o,{prop:"createTime",label:"时间",width:"180"})]),_:1},8,["data"])])):j("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(X,{modelValue:P.value,"onUpdate:modelValue":l[6]||(l[6]=a=>P.value=a),title:"举报详情",width:"600px"},{default:t(()=>{var a,w;return[i.value?(c(),N(W,{key:0,column:2,border:""},{default:t(()=>[e(p,{label:"举报人"},{default:t(()=>[r(d(i.value.reporterName),1)]),_:1}),e(p,{label:"被举报人"},{default:t(()=>[r(d(i.value.reportedName),1)]),_:1}),e(p,{label:"举报类型"},{default:t(()=>[r(d(k(i.value.type)),1)]),_:1}),e(p,{label:"关联订单"},{default:t(()=>[r(d(i.value.orderId||"无"),1)]),_:1}),e(p,{label:"举报描述",span:2},{default:t(()=>[r(d(i.value.description),1)]),_:1}),e(p,{label:"举报时间",span:2},{default:t(()=>[r(d(i.value.createTime),1)]),_:1})]),_:1})):j("",!0),(w=(a=i.value)==null?void 0:a.evidenceImages)!=null&&w.length?(c(),V("div",ze,[l[17]||(l[17]=C("h4",null,"证据图片",-1)),(c(!0),V(he,null,Ve(i.value.evidenceImages,(be,we)=>(c(),N(ge,{key:we,src:be,"preview-src-list":i.value.evidenceImages,fit:"cover",style:{width:"100px",height:"100px","margin-right":"10px"}},null,8,["src","preview-src-list"]))),128))])):j("",!0)]}),_:1},8,["modelValue"]),e(X,{modelValue:g.value,"onUpdate:modelValue":l[9]||(l[9]=a=>g.value=a),title:_.value?"通过举报":"驳回举报",width:"400px"},{footer:t(()=>[e(v,{onClick:l[8]||(l[8]=a=>g.value=!1)},{default:t(()=>[...l[18]||(l[18]=[r("取消",-1)])]),_:1}),e(v,{type:_.value?"success":"danger",onClick:ie,loading:z.value},{default:t(()=>[r(" 确定"+d(_.value?"通过":"驳回"),1)]),_:1},8,["type","loading"])]),default:t(()=>[e(ye,{model:y,"label-width":"80px"},{default:t(()=>[e(_e,{label:"处理备注"},{default:t(()=>[e(Q,{modelValue:y.remark,"onUpdate:modelValue":l[7]||(l[7]=a=>y.remark=a),type:"textarea",rows:3,placeholder:"请输入处理备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Pe=Ce(Ue,[["__scopeId","data-v-15cb6284"]]);export{Pe as default};
