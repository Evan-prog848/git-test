import{_ as oe,o as ne,b as f,c as z,e as l,w as a,r as n,i as u,K as M,J as se,F as P,B as h,f as D,h as ue,l as d,I as re,d as j,u as de,U as ie,P as i}from"./index-Bc-dwE5O.js";import{s as _}from"./request-bgZeUyhp.js";import"./auth-BBsyecEI.js";const pe={class:"trading-point-manage"},me={class:"card-header"},ce={__name:"TradingPointManage",setup(fe){const V=u(!1),w=u(!1),S=u([]),C=u([]),k=u(1),x=u(10),$=u(0),g=M({campusId:"",keyword:""}),p=u(!1),b=u(!1),B=u(null),s=M({id:null,campusId:"",name:"",location:"",sort:0,status:1}),K={campusId:[{required:!0,message:"请选择校区",trigger:"change"}],name:[{required:!0,message:"请输入交易点名称",trigger:"blur"}]},T=async()=>{try{const o=await _.get("/campus/list");C.value=o.data||[]}catch(o){console.error("获取校区列表失败:",o)}},r=async()=>{V.value=!0;try{const o=await _.get("/admin/trading-point/list",{params:{pageNum:k.value,pageSize:x.value,...g}});S.value=o.data.records||[],$.value=o.data.total||0}catch(o){console.error("获取交易点列表失败:",o)}finally{V.value=!1}},q=()=>{b.value=!1,Object.assign(s,{id:null,campusId:"",name:"",location:"",sort:0,status:1}),p.value=!0},F=o=>{b.value=!0,Object.assign(s,o),p.value=!0},O=async()=>{await B.value.validate(),w.value=!0;try{b.value?(await _.put("/admin/trading-point/update",s),i.success("更新成功")):(await _.post("/admin/trading-point/add",s),i.success("添加成功")),p.value=!1,r()}catch(o){i.error(o.message||"操作失败")}finally{w.value=!1}},R=async o=>{try{await _.delete(`/admin/trading-point/${o}`),i.success("删除成功"),r()}catch{i.error("删除失败")}},A=async o=>{try{await _.put(`/admin/trading-point/status/${o.id}`,null,{params:{status:o.status}}),i.success("状态更新成功")}catch{o.status=o.status===1?0:1,i.error("状态更新失败")}};return ne(()=>{T(),r()}),(o,e)=>{const J=n("el-icon"),m=n("el-button"),N=n("el-option"),E=n("el-select"),U=n("el-col"),I=n("el-input"),G=n("el-row"),c=n("el-table-column"),H=n("el-switch"),Q=n("el-popconfirm"),W=n("el-table"),X=n("el-pagination"),Y=n("el-card"),v=n("el-form-item"),Z=n("el-input-number"),L=n("el-radio"),ee=n("el-radio-group"),le=n("el-form"),te=n("el-dialog"),ae=se("loading");return f(),z("div",pe,[l(Y,null,{header:a(()=>[j("div",me,[e[12]||(e[12]=j("span",null,"交易点管理",-1)),l(m,{type:"primary",onClick:q},{default:a(()=>[l(J,null,{default:a(()=>[l(de(ie))]),_:1}),e[11]||(e[11]=d(" 添加交易点 ",-1))]),_:1})])]),default:a(()=>[l(G,{gutter:16,style:{"margin-bottom":"16px"}},{default:a(()=>[l(U,{span:6},{default:a(()=>[l(E,{modelValue:g.campusId,"onUpdate:modelValue":e[0]||(e[0]=t=>g.campusId=t),placeholder:"选择校区",clearable:"",onChange:r},{default:a(()=>[(f(!0),z(P,null,h(C.value,t=>(f(),D(N,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(U,{span:6},{default:a(()=>[l(I,{modelValue:g.keyword,"onUpdate:modelValue":e[1]||(e[1]=t=>g.keyword=t),placeholder:"搜索交易点",clearable:"",onKeyup:ue(r,["enter"])},null,8,["modelValue"])]),_:1}),l(U,{span:4},{default:a(()=>[l(m,{type:"primary",onClick:r},{default:a(()=>[...e[13]||(e[13]=[d("搜索",-1)])]),_:1})]),_:1})]),_:1}),re((f(),D(W,{data:S.value,stripe:""},{default:a(()=>[l(c,{prop:"id",label:"ID",width:"80"}),l(c,{prop:"name",label:"交易点名称"}),l(c,{prop:"location",label:"具体位置"}),l(c,{prop:"sort",label:"排序",width:"80"}),l(c,{prop:"status",label:"状态",width:"100"},{default:a(({row:t})=>[l(H,{modelValue:t.status,"onUpdate:modelValue":y=>t.status=y,"active-value":1,"inactive-value":0,onChange:y=>A(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(c,{label:"操作",width:"150",fixed:"right"},{default:a(({row:t})=>[l(m,{type:"primary",link:"",onClick:y=>F(t)},{default:a(()=>[...e[14]||(e[14]=[d("编辑",-1)])]),_:1},8,["onClick"]),l(Q,{title:"确定删除该交易点吗？",onConfirm:y=>R(t.id)},{reference:a(()=>[l(m,{type:"danger",link:""},{default:a(()=>[...e[15]||(e[15]=[d("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[ae,V.value]]),l(X,{"current-page":k.value,"onUpdate:currentPage":e[2]||(e[2]=t=>k.value=t),"page-size":x.value,"onUpdate:pageSize":e[3]||(e[3]=t=>x.value=t),total:$.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:r,onCurrentChange:r,style:{"margin-top":"16px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),l(te,{modelValue:p.value,"onUpdate:modelValue":e[10]||(e[10]=t=>p.value=t),title:b.value?"编辑交易点":"添加交易点",width:"500px"},{footer:a(()=>[l(m,{onClick:e[9]||(e[9]=t=>p.value=!1)},{default:a(()=>[...e[18]||(e[18]=[d("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:O,loading:w.value},{default:a(()=>[...e[19]||(e[19]=[d("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(le,{model:s,rules:K,ref_key:"formRef",ref:B,"label-width":"100px"},{default:a(()=>[l(v,{label:"所属校区",prop:"campusId"},{default:a(()=>[l(E,{modelValue:s.campusId,"onUpdate:modelValue":e[4]||(e[4]=t=>s.campusId=t),placeholder:"请选择校区",style:{width:"100%"}},{default:a(()=>[(f(!0),z(P,null,h(C.value,t=>(f(),D(N,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"交易点名称",prop:"name"},{default:a(()=>[l(I,{modelValue:s.name,"onUpdate:modelValue":e[5]||(e[5]=t=>s.name=t),placeholder:"如：图书馆大厅"},null,8,["modelValue"])]),_:1}),l(v,{label:"具体位置",prop:"location"},{default:a(()=>[l(I,{modelValue:s.location,"onUpdate:modelValue":e[6]||(e[6]=t=>s.location=t),placeholder:"请输入具体位置描述"},null,8,["modelValue"])]),_:1}),l(v,{label:"排序",prop:"sort"},{default:a(()=>[l(Z,{modelValue:s.sort,"onUpdate:modelValue":e[7]||(e[7]=t=>s.sort=t),min:0,max:999},null,8,["modelValue"])]),_:1}),l(v,{label:"状态",prop:"status"},{default:a(()=>[l(ee,{modelValue:s.status,"onUpdate:modelValue":e[8]||(e[8]=t=>s.status=t)},{default:a(()=>[l(L,{label:1},{default:a(()=>[...e[16]||(e[16]=[d("启用",-1)])]),_:1}),l(L,{label:0},{default:a(()=>[...e[17]||(e[17]=[d("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},be=oe(ce,[["__scopeId","data-v-1eaf5f92"]]);export{be as default};
