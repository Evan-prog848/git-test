import{_ as A,o as G,b as u,c as y,d as s,e as l,w as a,I as H,f as C,g as z,r as n,J as O,i,j as Q,l as p,h as X,u as Y,s as Z,F as ee,B as te,t as d,K as le,P as oe}from"./index-Bc-dwE5O.js";import{u as ae}from"./user-BS79HK15.js";import{s as S}from"./request-bgZeUyhp.js";import"./auth-BBsyecEI.js";const se=m=>S.get("/wanted/list",{params:m}),ne=m=>S.post("/wanted/publish",m),re={class:"container wanted-list-page"},ie={class:"page-header"},ue={class:"wanted-list"},de={class:"item-header"},ce={class:"book-name"},pe={class:"price"},me={class:"item-body"},_e={class:"desc"},fe={class:"tags"},ve={class:"item-footer"},ge={class:"user"},he={class:"time"},ye={key:1,class:"pagination"},Ve={__name:"WantedList",setup(m){const U=ae(),V=Q(),_=i(!1),w=i(""),b=i([]),c=i(!1),L=i(null),x=i(0),k=i(1),P=i(10),o=le({title:"",maxPrice:0,author:"",description:""}),B={title:[{required:!0,message:"请输入教材名称",trigger:"blur"}],description:[{required:!0,message:"请输入需求描述",trigger:"blur"}],maxPrice:[{required:!0,message:"请输入预算金额",trigger:"blur"}]},f=async()=>{_.value=!0;try{const r=await se({pageNum:k.value,pageSize:P.value,keyword:w.value||void 0});b.value=r.data.records||[],x.value=r.data.total||0}catch(r){console.error("获取求购列表失败:",r)}finally{_.value=!1}},W=()=>{if(!U.isLogin){V.push("/login");return}c.value=!0},q=()=>{L.value.validate(async r=>{if(r)try{await ne({title:o.title,maxPrice:o.maxPrice,author:o.author,description:o.description}),oe.success("求购信息发布成功"),c.value=!1,o.title="",o.maxPrice=0,o.author="",o.description="",f()}catch(e){console.error("发布求购失败:",e)}})},I=r=>{if(!U.isLogin){V.push("/login");return}V.push({path:"/chat",query:{userId:r.userId}})};return G(f),(r,e)=>{const v=n("el-button"),g=n("el-input"),N=n("el-card"),D=n("el-tag"),F=n("el-avatar"),K=n("el-col"),R=n("el-row"),E=n("el-empty"),M=n("el-pagination"),h=n("el-form-item"),T=n("el-input-number"),$=n("el-form"),j=n("el-dialog"),J=O("loading");return u(),y("div",re,[s("div",ie,[e[10]||(e[10]=s("div",{class:"title-section"},[s("h2",null,"求购专区"),s("p",null,"发布你需要的教材，让卖家找上门")],-1)),l(v,{type:"primary",size:"large",onClick:W},{default:a(()=>[...e[9]||(e[9]=[p("发布求购",-1)])]),_:1})]),l(N,{shadow:"never",class:"filter-card"},{default:a(()=>[l(g,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t),placeholder:"搜索求购教材...",class:"search-input","prefix-icon":Y(Z),clearable:"",onKeyup:X(f,["enter"])},null,8,["modelValue","prefix-icon"])]),_:1}),H((u(),y("div",ue,[l(R,{gutter:20},{default:a(()=>[(u(!0),y(ee,null,te(b.value,t=>(u(),C(K,{span:12,key:t.id},{default:a(()=>[l(N,{shadow:"hover",class:"wanted-item"},{default:a(()=>[s("div",de,[s("span",ce,d(t.title),1),s("span",pe,"预算: ¥"+d(t.maxPrice),1)]),s("div",me,[s("p",_e,d(t.description),1),s("div",fe,[t.author?(u(),C(D,{key:0,size:"small"},{default:a(()=>[p(d(t.author),1)]),_:2},1024)):z("",!0)])]),s("div",ve,[s("div",ge,[l(F,{size:24,src:t.avatar},null,8,["src"]),s("span",null,d(t.nickname),1)]),s("div",he,d(t.createTime),1),l(v,{type:"primary",plain:"",size:"small",onClick:we=>I(t)},{default:a(()=>[...e[11]||(e[11]=[p("我有书",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),!_.value&&b.value.length===0?(u(),C(E,{key:0,description:"暂无求购信息"})):z("",!0),x.value>0?(u(),y("div",ye,[l(M,{"current-page":k.value,"onUpdate:currentPage":e[1]||(e[1]=t=>k.value=t),"page-size":P.value,"onUpdate:pageSize":e[2]||(e[2]=t=>P.value=t),total:x.value,layout:"total, prev, pager, next",onCurrentChange:f},null,8,["current-page","page-size","total"])])):z("",!0)])),[[J,_.value]]),l(j,{modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=t=>c.value=t),title:"发布求购需求",width:"500px"},{footer:a(()=>[l(v,{onClick:e[7]||(e[7]=t=>c.value=!1)},{default:a(()=>[...e[12]||(e[12]=[p("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:q},{default:a(()=>[...e[13]||(e[13]=[p("发布",-1)])]),_:1})]),default:a(()=>[l($,{model:o,rules:B,ref_key:"formRef",ref:L,"label-width":"80px"},{default:a(()=>[l(h,{label:"教材名称",prop:"title"},{default:a(()=>[l(g,{modelValue:o.title,"onUpdate:modelValue":e[3]||(e[3]=t=>o.title=t),placeholder:"如：计算机网络 第八版"},null,8,["modelValue"])]),_:1}),l(h,{label:"预算金额",prop:"maxPrice"},{default:a(()=>[l(T,{modelValue:o.maxPrice,"onUpdate:modelValue":e[4]||(e[4]=t=>o.maxPrice=t),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(h,{label:"作者"},{default:a(()=>[l(g,{modelValue:o.author,"onUpdate:modelValue":e[5]||(e[5]=t=>o.author=t),placeholder:"如：谢希仁"},null,8,["modelValue"])]),_:1}),l(h,{label:"需求描述",prop:"description"},{default:a(()=>[l(g,{type:"textarea",modelValue:o.description,"onUpdate:modelValue":e[6]||(e[6]=t=>o.description=t),rows:"3",placeholder:"描述书名、成色要求等"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ce=A(Ve,[["__scopeId","data-v-c9cef0a6"]]);export{Ce as default};
