import{_ as ie,o as re,I as ue,b as _,c as p,e as a,w as s,g as x,J as de,i as c,r as i,L as ce,j as ve,l as u,d as t,F as U,B as S,n as _e,t as r,u as T,G as me,f as z,N as pe,x as fe,m as ge,O as be,P as k}from"./index-Bc-dwE5O.js";import{u as ke}from"./user-BS79HK15.js";import{a as ye}from"./textbook-Pf6eG0Sa.js";import{c as he}from"./order-C2TaVp-T.js";import{c as we,t as Ve}from"./favorite-NgHMPl8T.js";import{a as xe}from"./common-BUf8eMW3.js";import"./auth-BBsyecEI.js";import"./request-bgZeUyhp.js";const Te={class:"container textbook-detail-page"},Ce={key:0,class:"detail-container"},Ie={class:"image-gallery"},Pe={class:"thumbnail-list"},De=["onClick"],Be={class:"book-info-header"},Fe={class:"title"},Le={class:"meta"},Ne={class:"view-count"},Ue={class:"create-time"},Se={class:"price-section"},ze={class:"price-row"},Oe={class:"price"},Re={class:"original-price"},Ee={class:"condition-row"},Me={key:0,class:"seller-card"},$e={class:"seller-info"},je={class:"seller-text"},qe={class:"nickname"},Ae={class:"school"},Ge={key:0,class:"actions"},Je={class:"detail-list"},He={class:"detail-item"},Ke={class:"value"},Qe={class:"detail-item"},We={class:"value"},Xe={class:"detail-item"},Ye={class:"value"},Ze={class:"detail-item"},et={class:"value"},tt={class:"actions-footer"},lt={class:"description-content"},at={class:"price-text"},st={class:"dialog-footer"},ot="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",nt={__name:"TextbookDetail",setup(it){const O=ce(),f=ve(),g=ke(),C=c(!1),I=c(!1),l=c(null),y=c(""),P=c("description"),m=c(!1),V=c(!1),h=c(!1),D=c([]),d=c({tradingPointId:"",meetingTime:"",remark:""}),R=n=>n.getTime()<Date.now()-864e5,E=async()=>{try{const n=await xe();n.code===200&&(D.value=n.data||[])}catch(n){console.error("加载交易点失败:",n)}},M=be(()=>{var n,e,v;return((e=(n=l.value)==null?void 0:n.seller)==null?void 0:e.id)===((v=g.userInfo)==null?void 0:v.id)}),$=async()=>{C.value=!0;try{const n=O.params.id,e=await ye(n);if(l.value=e.data,l.value.images&&l.value.images.length>0?y.value=l.value.images[0]:y.value=l.value.cover,g.isLogin)try{const v=await we(n);m.value=v.data}catch{}}catch{}finally{C.value=!1}},j=async()=>{if(!g.isLogin){f.push("/login");return}try{await Ve(l.value.id),m.value=!m.value,k.success(m.value?"收藏成功":"取消收藏")}catch{k.error("操作失败")}},q=()=>{if(!g.isLogin){f.push("/login");return}V.value=!V.value,k.success(V.value?"关注成功":"取消关注")},A=()=>{if(!g.isLogin){f.push("/login");return}h.value=!0},G=async()=>{if(!d.value.tradingPointId){k.warning("请选择交易地点");return}if(!d.value.meetingTime){k.warning("请选择见面时间");return}I.value=!0;try{await he({textbookId:l.value.id,tradingPointId:d.value.tradingPointId,meetingTime:d.value.meetingTime,remark:d.value.remark}),k.success("购买申请已发送，请等待卖家确认"),h.value=!1,f.push("/orders")}catch{}finally{I.value=!1}},J=()=>{var n,e;if(!g.isLogin){f.push("/login");return}(e=(n=l.value)==null?void 0:n.seller)!=null&&e.id&&f.push({path:"/messages",query:{userId:l.value.seller.id,nickname:l.value.seller.nickname,avatar:l.value.seller.avatar||""}})};return re(()=>{$(),E()}),(n,e)=>{const v=i("el-breadcrumb-item"),H=i("el-breadcrumb"),B=i("el-image"),F=i("el-col"),K=i("el-icon"),Q=i("el-divider"),L=i("el-tag"),W=i("el-avatar"),b=i("el-button"),X=i("el-row"),N=i("el-tab-pane"),Y=i("el-tabs"),w=i("el-form-item"),Z=i("el-option"),ee=i("el-select"),te=i("el-date-picker"),le=i("el-input"),ae=i("el-form"),se=i("el-dialog"),oe=de("loading");return ue((_(),p("div",Te,[a(H,{separator:"/",class:"breadcrumb"},{default:s(()=>[a(v,{to:{path:"/"}},{default:s(()=>[...e[6]||(e[6]=[u("首页",-1)])]),_:1}),a(v,{to:{path:"/textbooks"}},{default:s(()=>[...e[7]||(e[7]=[u("教材列表",-1)])]),_:1}),a(v,null,{default:s(()=>[...e[8]||(e[8]=[u("教材详情",-1)])]),_:1})]),_:1}),l.value?(_(),p("div",Ce,[a(X,{gutter:40},{default:s(()=>[a(F,{span:10},{default:s(()=>[t("div",Ie,[a(B,{src:y.value||l.value.cover,class:"main-image",fit:"cover","preview-src-list":l.value.images},null,8,["src","preview-src-list"]),t("div",Pe,[(_(!0),p(U,null,S(l.value.images,(o,ne)=>(_(),p("div",{key:ne,class:_e(["thumbnail-item",{active:y.value===o}]),onClick:rt=>y.value=o},[a(B,{src:o,fit:"cover"},null,8,["src"])],10,De))),128))])])]),_:1}),a(F,{span:14},{default:s(()=>[t("div",Be,[t("h1",Fe,r(l.value.title),1),t("div",Le,[t("span",Ne,[a(K,null,{default:s(()=>[a(T(me))]),_:1}),u(" "+r(l.value.viewCount)+" 次浏览",1)]),a(Q,{direction:"vertical"}),t("span",Ue,"发布于 "+r(l.value.createTime),1)])]),t("div",Se,[t("div",ze,[e[9]||(e[9]=t("span",{class:"label"},"售价",-1)),t("span",Oe,"¥"+r(l.value.price),1),t("span",Re,"原价 ¥"+r(l.value.originalPrice),1)]),t("div",Ee,[e[10]||(e[10]=t("span",{class:"label"},"成色",-1)),a(L,{type:"success"},{default:s(()=>[u(r(l.value.conditionLevel)+"成新",1)]),_:1})])]),l.value.seller?(_(),p("div",Me,[t("div",$e,[a(W,{size:50,src:l.value.seller.avatar||ot},null,8,["src"]),t("div",je,[t("div",qe,[u(r(l.value.seller.nickname)+" ",1),l.value.seller.isVerified?(_(),z(L,{key:0,size:"small",type:"warning"},{default:s(()=>[...e[11]||(e[11]=[u("已认证",-1)])]),_:1})):x("",!0)]),t("div",Ae,r(l.value.seller.school)+" · "+r(l.value.seller.college),1)]),M.value?x("",!0):(_(),p("div",Ge,[a(b,{type:"primary",plain:"",onClick:q},{default:s(()=>[u(r(V.value?"已关注":"关注他"),1)]),_:1}),a(b,{type:"primary",onClick:A},{default:s(()=>[...e[12]||(e[12]=[u("立即购买",-1)])]),_:1})]))])])):x("",!0),t("div",Je,[t("div",He,[e[13]||(e[13]=t("span",{class:"label"},"作者",-1)),t("span",Ke,r(l.value.author),1)]),t("div",Qe,[e[14]||(e[14]=t("span",{class:"label"},"出版社",-1)),t("span",We,r(l.value.publisher),1)]),t("div",Xe,[e[15]||(e[15]=t("span",{class:"label"},"ISBN",-1)),t("span",Ye,r(l.value.isbn),1)]),t("div",Ze,[e[16]||(e[16]=t("span",{class:"label"},"适用课程",-1)),t("span",et,r(l.value.course||"无"),1)])]),t("div",tt,[a(b,{type:m.value?"warning":"default",icon:m.value?T(pe):T(fe),onClick:j},{default:s(()=>[u(r(m.value?"已收藏":"收藏"),1)]),_:1},8,["type","icon"]),a(b,{icon:T(ge),onClick:J},{default:s(()=>[...e[17]||(e[17]=[u("联系卖家",-1)])]),_:1},8,["icon"])])]),_:1})]),_:1}),a(Y,{modelValue:P.value,"onUpdate:modelValue":e[0]||(e[0]=o=>P.value=o),class:"detail-tabs"},{default:s(()=>[a(N,{label:"教材描述",name:"description"},{default:s(()=>[t("div",lt,r(l.value.description||"卖家暂未填写描述信息。"),1)]),_:1}),a(N,{label:"交易评价",name:"reviews"},{default:s(()=>[...e[18]||(e[18]=[t("div",{class:"reviews-content"},[t("p",null,"暂无评价")],-1)])]),_:1})]),_:1},8,["modelValue"])])):x("",!0),a(se,{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=o=>h.value=o),title:"发起购买申请",width:"500px"},{footer:s(()=>[t("span",st,[a(b,{onClick:e[4]||(e[4]=o=>h.value=!1)},{default:s(()=>[...e[19]||(e[19]=[u("取消",-1)])]),_:1}),a(b,{type:"primary",onClick:G,loading:I.value},{default:s(()=>[...e[20]||(e[20]=[u(" 提交申请 ",-1)])]),_:1},8,["loading"])])]),default:s(()=>[a(ae,{model:d.value,"label-width":"100px"},{default:s(()=>[a(w,{label:"教材"},{default:s(()=>{var o;return[t("span",null,r((o=l.value)==null?void 0:o.title),1)]}),_:1}),a(w,{label:"价格"},{default:s(()=>{var o;return[t("span",at,"¥"+r((o=l.value)==null?void 0:o.price),1)]}),_:1}),a(w,{label:"交易点"},{default:s(()=>[a(ee,{modelValue:d.value.tradingPointId,"onUpdate:modelValue":e[1]||(e[1]=o=>d.value.tradingPointId=o),placeholder:"请选择交易地点",style:{width:"100%"}},{default:s(()=>[(_(!0),p(U,null,S(D.value,o=>(_(),z(Z,{key:o.id,label:o.name+(o.location?" - "+o.location:""),value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(w,{label:"见面时间"},{default:s(()=>[a(te,{modelValue:d.value.meetingTime,"onUpdate:modelValue":e[2]||(e[2]=o=>d.value.meetingTime=o),type:"datetime",placeholder:"请选择见面时间",style:{width:"100%"},"disabled-date":R},null,8,["modelValue"])]),_:1}),a(w,{label:"备注"},{default:s(()=>[a(le,{type:"textarea",modelValue:d.value.remark,"onUpdate:modelValue":e[3]||(e[3]=o=>d.value.remark=o),placeholder:"其他沟通信息",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])),[[oe,C.value]])}}},gt=ie(nt,[["__scopeId","data-v-a35cc322"]]);export{gt as default};
