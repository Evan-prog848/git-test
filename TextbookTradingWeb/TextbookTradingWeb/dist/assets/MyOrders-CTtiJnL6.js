import{_ as _e,o as be,b as m,c as F,e as t,w as l,i as p,r as d,J as ye,I as j,f as b,d as o,t as r,l as i,g as y,u as we,U as ge,Z as D,P as f}from"./index-Bc-dwE5O.js";import{g as Q,a as ke,b as Ce,d as Ve,e as xe,f as Oe,r as ze}from"./order-C2TaVp-T.js";import{r as Ne}from"./common-BUf8eMW3.js";import{s as Te}from"./request-bgZeUyhp.js";import"./auth-BBsyecEI.js";const Ie={class:"container my-orders-page"},he={class:"order-book-info"},Ue={class:"book-detail"},De={class:"book-name"},Le={class:"order-no"},$e={class:"price"},Re={class:"seller-info"},Se={class:"order-book-info"},Be={class:"book-detail"},Ee={class:"book-name"},Me={class:"order-no"},Ae={class:"price"},Fe={class:"buyer-info"},je={class:"order-detail"},Pe={key:0,class:"detail-content"},Je={class:"detail-header"},Ze={class:"order-no"},qe={class:"book-info"},Ge={class:"book-meta"},He={class:"book-title"},Ke={class:"book-price"},Qe={class:"trade-parties"},We={class:"party"},Xe={class:"name"},Ye={class:"party"},et={class:"name"},tt={class:"trade-info"},lt={class:"info-item"},at={class:"value"},ot={class:"info-item"},st={class:"value"},nt={class:"remark"},rt={class:"time-info"},it={__name:"MyOrders",setup(dt){const z=p(!1),N=p("buy"),P=p([]),L=p([]),T=p(0),C=p(!1),w=p({orderId:null,score:5,content:""}),I=p(!1),$=p(!1),n=p(null),V=p(!1),R=p(!1),u=p({type:null,description:"",evidenceList:[],evidenceImages:[]}),W=(s,e)=>{u.value.evidenceList=e},X=(s,e)=>{u.value.evidenceList=e},S=s=>s?new Date(s).toLocaleString("zh-CN"):"-",J=s=>["待确认","已确认","已完成","已取消"][s],B=s=>["","warning","success","info"][s],g=async()=>{z.value=!0;try{if(N.value==="buy"){const s=await ke({pageNum:1,pageSize:100});P.value=s.data.records}else{const s=await Q({pageNum:1,pageSize:100});L.value=s.data.records,T.value=L.value.filter(e=>e.status===0).length}}catch{}finally{z.value=!1}},Y=s=>{g()},ee=s=>{D.confirm("确认已收到教材并完成交易吗？","提示").then(async()=>{await Ce(s.id),f.success("交易已完成"),g()})},te=s=>{D.confirm("确定取消该订单吗？","提示",{type:"warning"}).then(async()=>{await Ve(s.id),f.success("订单已取消"),g()})},le=s=>{w.value.orderId=s.id,C.value=!0},ae=()=>{f.success("评价成功"),C.value=!1},oe=s=>{D.confirm("确认接受该购买申请吗？","提示").then(async()=>{await Oe(s.id),f.success("已确认订单"),g()})},se=s=>{D.confirm("确定拒绝该购买申请吗？","提示",{type:"warning"}).then(async()=>{await ze(s.id),f.success("已拒绝申请"),g()})},Z=async s=>{I.value=!0,$.value=!0,n.value=null;try{const e=await xe(s.id);n.value=e.data}catch{f.error("获取订单详情失败")}finally{$.value=!1}};be(()=>{g(),ne()});const ne=async()=>{try{const e=(await Q({pageNum:1,pageSize:100})).data.records||[];T.value=e.filter(_=>_.status===0).length}catch(s){console.error("Failed to load seller orders count:",s)}},re=()=>{u.value={type:null,description:"",evidenceList:[],evidenceImages:[]},V.value=!0},ie=async()=>{if(!u.value.type){f.warning("请选择举报类型");return}if(!u.value.description.trim()){f.warning("请填写举报描述");return}const s=N.value==="buy"?n.value.sellerId:n.value.buyerId;R.value=!0;try{let e=[];if(u.value.evidenceList.length>0){const _=new FormData;u.value.evidenceList.forEach(v=>{v.raw&&_.append("files",v.raw)}),_.has("files")&&(e=(await Te.post("/file/uploads",_,{headers:{"Content-Type":"multipart/form-data"}})).data||[])}await Ne({userId:s,type:u.value.type,description:u.value.description,orderId:n.value.id,evidenceImages:e}),f.success("举报已提交，管理员将尽快处理"),V.value=!1}catch{f.error("举报提交失败")}finally{R.value=!1}};return(s,e)=>{const _=d("el-image"),v=d("el-table-column"),h=d("el-avatar"),E=d("el-tag"),c=d("el-button"),q=d("el-table"),G=d("el-tab-pane"),de=d("el-badge"),ue=d("el-tabs"),ve=d("el-card"),x=d("el-divider"),M=d("el-dialog"),U=d("el-option"),ce=d("el-select"),O=d("el-form-item"),H=d("el-input"),pe=d("el-icon"),me=d("el-upload"),K=d("el-form"),fe=d("el-rate"),A=ye("loading");return m(),F("div",Ie,[t(ve,null,{header:l(()=>[...e[11]||(e[11]=[o("div",{class:"card-header"},[o("span",{class:"title"},"我的订单")],-1)])]),default:l(()=>[t(ue,{modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=a=>N.value=a),onTabChange:Y},{default:l(()=>[t(G,{name:"buy"},{label:l(()=>[...e[12]||(e[12]=[o("span",null,"我买到的",-1)])]),default:l(()=>[j((m(),b(q,{data:P.value},{default:l(()=>[t(v,{label:"订单信息",width:"400"},{default:l(a=>[o("div",he,[t(_,{src:a.row.textbookCover,class:"book-cover"},null,8,["src"]),o("div",Ue,[o("div",De,r(a.row.textbookTitle),1),o("div",Le,"订单号："+r(a.row.orderNo),1)])])]),_:1}),t(v,{prop:"price",label:"实付款",width:"120"},{default:l(a=>[o("span",$e,"¥"+r(a.row.price),1)]),_:1}),t(v,{label:"卖家",width:"150"},{default:l(a=>[o("div",Re,[t(h,{size:24,src:a.row.sellerAvatar},null,8,["src"]),o("span",null,r(a.row.sellerName),1)])]),_:1}),t(v,{prop:"status",label:"状态",width:"120"},{default:l(a=>[t(E,{type:B(a.row.status)},{default:l(()=>[i(r(J(a.row.status)),1)]),_:2},1032,["type"])]),_:1}),t(v,{label:"操作"},{default:l(a=>[a.row.status===1?(m(),b(c,{key:0,type:"primary",size:"small",onClick:k=>ee(a.row)},{default:l(()=>[...e[13]||(e[13]=[i(" 确认收货 ",-1)])]),_:1},8,["onClick"])):y("",!0),a.row.status===0?(m(),b(c,{key:1,type:"danger",size:"small",onClick:k=>te(a.row)},{default:l(()=>[...e[14]||(e[14]=[i(" 取消订单 ",-1)])]),_:1},8,["onClick"])):y("",!0),a.row.status===2?(m(),b(c,{key:2,type:"success",size:"small",onClick:k=>le(a.row)},{default:l(()=>[...e[15]||(e[15]=[i(" 评价 ",-1)])]),_:1},8,["onClick"])):y("",!0),t(c,{size:"small",onClick:k=>Z(a.row)},{default:l(()=>[...e[16]||(e[16]=[i("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[A,z.value]])]),_:1}),t(G,{name:"sell"},{label:l(()=>[t(de,{value:T.value,hidden:T.value===0,type:"danger"},{default:l(()=>[...e[17]||(e[17]=[o("span",null,"我卖出的",-1)])]),_:1},8,["value","hidden"])]),default:l(()=>[j((m(),b(q,{data:L.value},{default:l(()=>[t(v,{label:"订单信息",width:"400"},{default:l(a=>[o("div",Se,[t(_,{src:a.row.textbookCover,class:"book-cover"},null,8,["src"]),o("div",Be,[o("div",Ee,r(a.row.textbookTitle),1),o("div",Me,"订单号："+r(a.row.orderNo),1)])])]),_:1}),t(v,{prop:"price",label:"应收款",width:"120"},{default:l(a=>[o("span",Ae,"¥"+r(a.row.price),1)]),_:1}),t(v,{label:"买家",width:"150"},{default:l(a=>[o("div",Fe,[t(h,{size:24,src:a.row.buyerAvatar},null,8,["src"]),o("span",null,r(a.row.buyerName),1)])]),_:1}),t(v,{prop:"status",label:"状态",width:"120"},{default:l(a=>[t(E,{type:B(a.row.status)},{default:l(()=>[i(r(J(a.row.status)),1)]),_:2},1032,["type"])]),_:1}),t(v,{label:"操作"},{default:l(a=>[a.row.status===0?(m(),b(c,{key:0,type:"primary",size:"small",onClick:k=>oe(a.row)},{default:l(()=>[...e[18]||(e[18]=[i(" 确认订单 ",-1)])]),_:1},8,["onClick"])):y("",!0),a.row.status===0?(m(),b(c,{key:1,type:"danger",size:"small",onClick:k=>se(a.row)},{default:l(()=>[...e[19]||(e[19]=[i(" 拒绝 ",-1)])]),_:1},8,["onClick"])):y("",!0),t(c,{size:"small",onClick:k=>Z(a.row)},{default:l(()=>[...e[20]||(e[20]=[i("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[A,z.value]])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(M,{modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=a=>I.value=a),title:"订单详情",width:"600px"},{footer:l(()=>[t(c,{onClick:e[1]||(e[1]=a=>I.value=!1)},{default:l(()=>[...e[30]||(e[30]=[i("关闭",-1)])]),_:1}),n.value&&n.value.status>=1?(m(),b(c,{key:0,type:"danger",onClick:re},{default:l(()=>[...e[31]||(e[31]=[i(" 举报 ",-1)])]),_:1})):y("",!0)]),default:l(()=>[j((m(),F("div",je,[n.value?(m(),F("div",Pe,[o("div",Je,[t(E,{type:B(n.value.status),size:"large"},{default:l(()=>[i(r(n.value.statusText),1)]),_:1},8,["type"]),o("span",Ze,"订单号："+r(n.value.orderNo),1)]),t(x,{"content-position":"left"},{default:l(()=>[...e[21]||(e[21]=[i("教材信息",-1)])]),_:1}),o("div",qe,[t(_,{src:n.value.textbookCover,class:"detail-cover",fit:"cover"},null,8,["src"]),o("div",Ge,[o("div",He,r(n.value.textbookTitle),1),o("div",Ke,"¥"+r(n.value.price),1)])]),t(x,{"content-position":"left"},{default:l(()=>[...e[22]||(e[22]=[i("交易双方",-1)])]),_:1}),o("div",Qe,[o("div",We,[e[23]||(e[23]=o("span",{class:"label"},"卖家：",-1)),t(h,{size:24,src:n.value.sellerAvatar},null,8,["src"]),o("span",Xe,r(n.value.sellerName),1)]),o("div",Ye,[e[24]||(e[24]=o("span",{class:"label"},"买家：",-1)),t(h,{size:24,src:n.value.buyerAvatar},null,8,["src"]),o("span",et,r(n.value.buyerName),1)])]),t(x,{"content-position":"left"},{default:l(()=>[...e[25]||(e[25]=[i("交易信息",-1)])]),_:1}),o("div",tt,[o("div",lt,[e[26]||(e[26]=o("span",{class:"label"},"交易地点：",-1)),o("span",at,r(n.value.tradingPointName||"未指定"),1)]),o("div",ot,[e[27]||(e[27]=o("span",{class:"label"},"见面时间：",-1)),o("span",st,r(n.value.meetingTime?S(n.value.meetingTime):"未指定"),1)])]),t(x,{"content-position":"left"},{default:l(()=>[...e[28]||(e[28]=[i("订单备注",-1)])]),_:1}),o("div",nt,r(n.value.remark||"无"),1),t(x,{"content-position":"left"},{default:l(()=>[...e[29]||(e[29]=[i("时间信息",-1)])]),_:1}),o("div",rt,[o("div",null,"创建时间："+r(S(n.value.createTime)),1),o("div",null,"更新时间："+r(S(n.value.updateTime)),1)])])):y("",!0)])),[[A,$.value]])]),_:1},8,["modelValue"]),t(M,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=a=>V.value=a),title:"举报用户",width:"550px"},{footer:l(()=>[t(c,{onClick:e[5]||(e[5]=a=>V.value=!1)},{default:l(()=>[...e[33]||(e[33]=[i("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:ie,loading:R.value},{default:l(()=>[...e[34]||(e[34]=[i("提交举报",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(K,{model:u.value,"label-width":"100px"},{default:l(()=>[t(O,{label:"举报类型"},{default:l(()=>[t(ce,{modelValue:u.value.type,"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.type=a),placeholder:"请选择举报类型",style:{width:"100%"}},{default:l(()=>[t(U,{label:"实物与描述不符",value:1}),t(U,{label:"爽约（未按时见面）",value:2}),t(U,{label:"态度恶劣",value:3}),t(U,{label:"其他违规行为",value:4})]),_:1},8,["modelValue"])]),_:1}),t(O,{label:"举报描述"},{default:l(()=>[t(H,{type:"textarea",modelValue:u.value.description,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value.description=a),placeholder:"请详细描述问题",rows:"3"},null,8,["modelValue"])]),_:1}),t(O,{label:"证据图片"},{default:l(()=>[t(me,{action:"#","list-type":"picture-card","auto-upload":!1,"file-list":u.value.evidenceList,"on-change":W,"on-remove":X,limit:3,accept:"image/*"},{default:l(()=>[t(pe,null,{default:l(()=>[t(we(ge))]),_:1})]),_:1},8,["file-list"]),e[32]||(e[32]=o("div",{class:"upload-tip"},"最多上传3张证据图片",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(M,{modelValue:C.value,"onUpdate:modelValue":e[10]||(e[10]=a=>C.value=a),title:"交易评价",width:"400px"},{footer:l(()=>[t(c,{onClick:e[9]||(e[9]=a=>C.value=!1)},{default:l(()=>[...e[35]||(e[35]=[i("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:ae},{default:l(()=>[...e[36]||(e[36]=[i("提交",-1)])]),_:1})]),default:l(()=>[t(K,{model:w.value,"label-width":"80px"},{default:l(()=>[t(O,{label:"评分"},{default:l(()=>[t(fe,{modelValue:w.value.score,"onUpdate:modelValue":e[7]||(e[7]=a=>w.value.score=a)},null,8,["modelValue"])]),_:1}),t(O,{label:"评价内容"},{default:l(()=>[t(H,{type:"textarea",modelValue:w.value.content,"onUpdate:modelValue":e[8]||(e[8]=a=>w.value.content=a),rows:"4"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ft=_e(it,[["__scopeId","data-v-fe8e38e0"]]);export{ft as default};
