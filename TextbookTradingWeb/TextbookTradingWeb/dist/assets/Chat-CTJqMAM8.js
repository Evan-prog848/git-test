import{a1 as h,a2 as Et,a3 as Ar,a4 as jr,_ as Ur,a5 as he,o as Lr,a as Mr,b as U,c as X,d as C,F as Re,B as Bt,f as ze,g as Ve,e as A,t as Q,w as se,l as Ne,h as Pr,a6 as Dr,i as Y,r as z,L as Br,a0 as Hr,j as qr,n as Ht,u as qt,a7 as Wr,$ as Fr,O as Xr,P as Wt}from"./index-Bc-dwE5O.js";import{s as De}from"./request-bgZeUyhp.js";import{u as Yr}from"./user-BS79HK15.js";import"./auth-BBsyecEI.js";function Jr(e){return De({url:"/chat/send",method:"post",data:e})}function Gr(){return De({url:"/chat/conversations",method:"get"})}function zr(e,t){return De({url:`/chat/history/${e}`,method:"get",params:t})}function Ft(e){return De({url:`/chat/read/${e}`,method:"put"})}var _n={exports:{}},lt={};h.crypto&&h.crypto.getRandomValues?lt.randomBytes=function(e){var t=new Uint8Array(e);return h.crypto.getRandomValues(t),t}:lt.randomBytes=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=Math.floor(Math.random()*256);return t};var Vr=lt,Xt="abcdefghijklmnopqrstuvwxyz012345",ue={string:function(e){for(var t=Xt.length,n=Vr.randomBytes(e),r=[],i=0;i<e;i++)r.push(Xt.substr(n[i]%t,1));return r.join("")},number:function(e){return Math.floor(Math.random()*e)},numberString:function(e){var t=(""+(e-1)).length,n=new Array(t+1).join("0");return(n+this.number(e)).slice(-t)}};(function(e){var t=ue,n={},r=!1,i=h.chrome&&h.chrome.app&&h.chrome.app.runtime;e.exports={attachEvent:function(a,c){typeof h.addEventListener<"u"?h.addEventListener(a,c,!1):h.document&&h.attachEvent&&(h.document.attachEvent("on"+a,c),h.attachEvent("on"+a,c))},detachEvent:function(a,c){typeof h.addEventListener<"u"?h.removeEventListener(a,c,!1):h.document&&h.detachEvent&&(h.document.detachEvent("on"+a,c),h.detachEvent("on"+a,c))},unloadAdd:function(a){if(i)return null;var c=t.string(8);return n[c]=a,r&&setTimeout(this.triggerUnloadCallbacks,0),c},unloadDel:function(a){a in n&&delete n[a]},triggerUnloadCallbacks:function(){for(var a in n)n[a](),delete n[a]}};var o=function(){r||(r=!0,e.exports.triggerUnloadCallbacks())};i||e.exports.attachEvent("unload",o)})(_n);var K=_n.exports,Kr=function(t,n){if(n=n.split(":")[0],t=+t,!t)return!1;switch(n){case"http":case"ws":return t!==80;case"https":case"wss":return t!==443;case"ftp":return t!==21;case"gopher":return t!==70;case"file":return!1}return t!==0},St={},Qr=Object.prototype.hasOwnProperty,Zr;function Yt(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch{return null}}function Jt(e){try{return encodeURIComponent(e)}catch{return null}}function ei(e){for(var t=/([^=?#&]+)=?([^&]*)/g,n={},r;r=t.exec(e);){var i=Yt(r[1]),o=Yt(r[2]);i===null||o===null||i in n||(n[i]=o)}return n}function ti(e,t){t=t||"";var n=[],r,i;typeof t!="string"&&(t="?");for(i in e)if(Qr.call(e,i)){if(r=e[i],!r&&(r===null||r===Zr||isNaN(r))&&(r=""),i=Jt(i),r=Jt(r),i===null||r===null)continue;n.push(i+"="+r)}return n.length?t+n.join("&"):""}St.stringify=ti;St.parse=ei;var wn=Kr,Be=St,ni=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,En=/[\n\r\t]/g,ri=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,Sn=/:\d+$/,ii=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,oi=/^[a-zA-Z]:/;function xt(e){return(e||"").toString().replace(ni,"")}var ft=[["#","hash"],["?","query"],function(t,n){return B(n.protocol)?t.replace(/\\/g,"/"):t},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],Gt={hash:1,query:1};function xn(e){var t;typeof window<"u"?t=window:typeof h<"u"?t=h:typeof self<"u"?t=self:t={};var n=t.location||{};e=e||n;var r={},i=typeof e,o;if(e.protocol==="blob:")r=new q(unescape(e.pathname),{});else if(i==="string"){r=new q(e,{});for(o in Gt)delete r[o]}else if(i==="object"){for(o in e)o in Gt||(r[o]=e[o]);r.slashes===void 0&&(r.slashes=ri.test(e.href))}return r}function B(e){return e==="file:"||e==="ftp:"||e==="http:"||e==="https:"||e==="ws:"||e==="wss:"}function Cn(e,t){e=xt(e),e=e.replace(En,""),t=t||{};var n=ii.exec(e),r=n[1]?n[1].toLowerCase():"",i=!!n[2],o=!!n[3],a=0,c;return i?o?(c=n[2]+n[3]+n[4],a=n[2].length+n[3].length):(c=n[2]+n[4],a=n[2].length):o?(c=n[3]+n[4],a=n[3].length):c=n[4],r==="file:"?a>=2&&(c=c.slice(2)):B(r)?c=n[4]:r?i&&(c=c.slice(2)):a>=2&&B(t.protocol)&&(c=n[4]),{protocol:r,slashes:i||B(r),slashesCount:a,rest:c}}function si(e,t){if(e==="")return t;for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),r=n.length,i=n[r-1],o=!1,a=0;r--;)n[r]==="."?n.splice(r,1):n[r]===".."?(n.splice(r,1),a++):a&&(r===0&&(o=!0),n.splice(r,1),a--);return o&&n.unshift(""),(i==="."||i==="..")&&n.push(""),n.join("/")}function q(e,t,n){if(e=xt(e),e=e.replace(En,""),!(this instanceof q))return new q(e,t,n);var r,i,o,a,c,l,u=ft.slice(),f=typeof t,s=this,d=0;for(f!=="object"&&f!=="string"&&(n=t,t=null),n&&typeof n!="function"&&(n=Be.parse),t=xn(t),i=Cn(e||"",t),r=!i.protocol&&!i.slashes,s.slashes=i.slashes||r&&t.slashes,s.protocol=i.protocol||t.protocol||"",e=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||oi.test(e))||!i.slashes&&(i.protocol||i.slashesCount<2||!B(s.protocol)))&&(u[3]=[/(.*)/,"pathname"]);d<u.length;d++){if(a=u[d],typeof a=="function"){e=a(e,s);continue}o=a[0],l=a[1],o!==o?s[l]=e:typeof o=="string"?(c=o==="@"?e.lastIndexOf(o):e.indexOf(o),~c&&(typeof a[2]=="number"?(s[l]=e.slice(0,c),e=e.slice(c+a[2])):(s[l]=e.slice(c),e=e.slice(0,c)))):(c=o.exec(e))&&(s[l]=c[1],e=e.slice(0,c.index)),s[l]=s[l]||r&&a[3]&&t[l]||"",a[4]&&(s[l]=s[l].toLowerCase())}n&&(s.query=n(s.query)),r&&t.slashes&&s.pathname.charAt(0)!=="/"&&(s.pathname!==""||t.pathname!=="")&&(s.pathname=si(s.pathname,t.pathname)),s.pathname.charAt(0)!=="/"&&B(s.protocol)&&(s.pathname="/"+s.pathname),wn(s.port,s.protocol)||(s.host=s.hostname,s.port=""),s.username=s.password="",s.auth&&(c=s.auth.indexOf(":"),~c?(s.username=s.auth.slice(0,c),s.username=encodeURIComponent(decodeURIComponent(s.username)),s.password=s.auth.slice(c+1),s.password=encodeURIComponent(decodeURIComponent(s.password))):s.username=encodeURIComponent(decodeURIComponent(s.auth)),s.auth=s.password?s.username+":"+s.password:s.username),s.origin=s.protocol!=="file:"&&B(s.protocol)&&s.host?s.protocol+"//"+s.host:"null",s.href=s.toString()}function ai(e,t,n){var r=this;switch(e){case"query":typeof t=="string"&&t.length&&(t=(n||Be.parse)(t)),r[e]=t;break;case"port":r[e]=t,wn(t,r.protocol)?t&&(r.host=r.hostname+":"+t):(r.host=r.hostname,r[e]="");break;case"hostname":r[e]=t,r.port&&(t+=":"+r.port),r.host=t;break;case"host":r[e]=t,Sn.test(t)?(t=t.split(":"),r.port=t.pop(),r.hostname=t.join(":")):(r.hostname=t,r.port="");break;case"protocol":r.protocol=t.toLowerCase(),r.slashes=!n;break;case"pathname":case"hash":if(t){var i=e==="pathname"?"/":"#";r[e]=t.charAt(0)!==i?i+t:t}else r[e]=t;break;case"username":case"password":r[e]=encodeURIComponent(t);break;case"auth":var o=t.indexOf(":");~o?(r.username=t.slice(0,o),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=t.slice(o+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(t))}for(var a=0;a<ft.length;a++){var c=ft[a];c[4]&&(r[c[1]]=r[c[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin=r.protocol!=="file:"&&B(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r}function ui(e){(!e||typeof e!="function")&&(e=Be.stringify);var t,n=this,r=n.host,i=n.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var o=i+(n.protocol&&n.slashes||B(n.protocol)?"//":"");return n.username?(o+=n.username,n.password&&(o+=":"+n.password),o+="@"):n.password?(o+=":"+n.password,o+="@"):n.protocol!=="file:"&&B(n.protocol)&&!r&&n.pathname!=="/"&&(o+="@"),(r[r.length-1]===":"||Sn.test(n.hostname)&&!n.port)&&(r+=":"),o+=r+n.pathname,t=typeof n.query=="object"?e(n.query):n.query,t&&(o+=t.charAt(0)!=="?"?"?"+t:t),n.hash&&(o+=n.hash),o}q.prototype={set:ai,toString:ui};q.extractProtocol=Cn;q.location=xn;q.trimLeft=xt;q.qs=Be;var Tn=q,ci=Tn,M={getOrigin:function(e){if(!e)return null;var t=new ci(e);if(t.protocol==="file:")return null;var n=t.port;return n||(n=t.protocol==="https:"?"443":"80"),t.protocol+"//"+t.hostname+":"+n},isOriginEqual:function(e,t){var n=this.getOrigin(e)===this.getOrigin(t);return n},isSchemeEqual:function(e,t){return e.split(":")[0]===t.split(":")[0]},addPath:function(e,t){var n=e.split("?");return n[0]+t+(n[1]?"?"+n[1]:"")},addQuery:function(e,t){return e+(e.indexOf("?")===-1?"?"+t:"&"+t)},isLoopbackAddr:function(e){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^\[::1\]$/.test(e)}},ht={exports:{}};typeof Object.create=="function"?ht.exports=function(t,n){n&&(t.super_=n,t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:ht.exports=function(t,n){if(n){t.super_=n;var r=function(){};r.prototype=n.prototype,t.prototype=new r,t.prototype.constructor=t}};var E=ht.exports,N={};function He(){this._listeners={}}He.prototype.addEventListener=function(e,t){e in this._listeners||(this._listeners[e]=[]);var n=this._listeners[e];n.indexOf(t)===-1&&(n=n.concat([t])),this._listeners[e]=n};He.prototype.removeEventListener=function(e,t){var n=this._listeners[e];if(n){var r=n.indexOf(t);if(r!==-1){n.length>1?this._listeners[e]=n.slice(0,r).concat(n.slice(r+1)):delete this._listeners[e];return}}};He.prototype.dispatchEvent=function(){var e=arguments[0],t=e.type,n=arguments.length===1?[e]:Array.apply(null,arguments);if(this["on"+t]&&this["on"+t].apply(this,n),t in this._listeners)for(var r=this._listeners[t],i=0;i<r.length;i++)r[i].apply(this,n)};var In=He,li=E,qe=In;function V(){qe.call(this)}li(V,qe);V.prototype.removeAllListeners=function(e){e?delete this._listeners[e]:this._listeners={}};V.prototype.once=function(e,t){var n=this,r=!1;function i(){n.removeListener(e,i),r||(r=!0,t.apply(this,arguments))}this.on(e,i)};V.prototype.emit=function(){var e=arguments[0],t=this._listeners[e];if(t){for(var n=arguments.length,r=new Array(n-1),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=0;o<t.length;o++)t[o].apply(this,r)}};V.prototype.on=V.prototype.addListener=qe.prototype.addEventListener;V.prototype.removeListener=qe.prototype.removeEventListener;N.EventEmitter=V;var dt={exports:{}},zt=h.WebSocket||h.MozWebSocket;zt?dt.exports=function(t){return new zt(t)}:dt.exports=void 0;var fi=dt.exports,On=K,hi=M,di=E,$n=N.EventEmitter,kn=fi,Vt=function(){};function G(e,t,n){if(!G.enabled())throw new Error("Transport created when disabled");$n.call(this);var r=this,i=hi.addPath(e,"/websocket");i.slice(0,5)==="https"?i="wss"+i.slice(5):i="ws"+i.slice(4),this.url=i,this.ws=new kn(this.url,[],n),this.ws.onmessage=function(o){Vt("message event",o.data),r.emit("message",o.data)},this.unloadRef=On.unloadAdd(function(){r.ws.close()}),this.ws.onclose=function(o){Vt("close event",o.code,o.reason),r.emit("close",o.code,o.reason),r._cleanup()},this.ws.onerror=function(o){r.emit("close",1006,"WebSocket connection broken"),r._cleanup()}}di(G,$n);G.prototype.send=function(e){var t="["+e+"]";this.ws.send(t)};G.prototype.close=function(){var e=this.ws;this._cleanup(),e&&e.close()};G.prototype._cleanup=function(){var e=this.ws;e&&(e.onmessage=e.onclose=e.onerror=null),On.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()};G.enabled=function(){return!!kn};G.transportName="websocket";G.roundTrips=2;var pi=G,mi=E,Rn=N.EventEmitter,vi=function(){};function ee(e,t){Rn.call(this),this.sendBuffer=[],this.sender=t,this.url=e}mi(ee,Rn);ee.prototype.send=function(e){this.sendBuffer.push(e),this.sendStop||this.sendSchedule()};ee.prototype.sendScheduleWait=function(){var e=this,t;this.sendStop=function(){e.sendStop=null,clearTimeout(t)},t=setTimeout(function(){e.sendStop=null,e.sendSchedule()},25)};ee.prototype.sendSchedule=function(){vi("sendSchedule",this.sendBuffer.length);var e=this;if(this.sendBuffer.length>0){var t="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,t,function(n){e.sendStop=null,n?(e.emit("close",n.code||1006,"Sending error: "+n),e.close()):e.sendScheduleWait()}),this.sendBuffer=[]}};ee.prototype._cleanup=function(){this.removeAllListeners()};ee.prototype.close=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)};var gi=ee,bi=E,Nn=N.EventEmitter,yi=function(){};function We(e,t,n){Nn.call(this),this.Receiver=e,this.receiveUrl=t,this.AjaxObject=n,this._scheduleReceiver()}bi(We,Nn);We.prototype._scheduleReceiver=function(){var e=this,t=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);t.on("message",function(n){e.emit("message",n)}),t.once("close",function(n,r){yi("close",n,r,e.pollIsClosing),e.poll=t=null,e.pollIsClosing||(r==="network"?e._scheduleReceiver():(e.emit("close",n||1006,r),e.removeAllListeners()))})};We.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()};var _i=We,wi=E,Ei=M,Ct=gi,Si=_i;function Tt(e,t,n,r,i){var o=Ei.addPath(e,t),a=this;Ct.call(this,e,n),this.poll=new Si(r,o,i),this.poll.on("message",function(c){a.emit("message",c)}),this.poll.once("close",function(c,l){a.poll=null,a.emit("close",c,l),a.close()})}wi(Tt,Ct);Tt.prototype.close=function(){Ct.prototype.close.call(this),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)};var An=Tt,xi=E,Ci=M,jn=An;function Ti(e){return function(t,n,r){var i={};typeof n=="string"&&(i.headers={"Content-type":"text/plain"});var o=Ci.addPath(t,"/xhr_send"),a=new e("POST",o,n,i);return a.once("finish",function(c){if(a=null,c!==200&&c!==204)return r(new Error("http status "+c));r()}),function(){a.close(),a=null;var c=new Error("Aborted");c.code=1e3,r(c)}}}function Un(e,t,n,r){jn.call(this,e,t,Ti(r),n,r)}xi(Un,jn);var ce=Un,Ii=E,Ln=N.EventEmitter;function _e(e,t){Ln.call(this);var n=this;this.bufferPosition=0,this.xo=new t("POST",e,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(r,i){n._chunkHandler(r,i),n.xo=null;var o=r===200?"network":"permanent";n.emit("close",null,o),n._cleanup()})}Ii(_e,Ln);_e.prototype._chunkHandler=function(e,t){if(!(e!==200||!t))for(var n=-1;;this.bufferPosition+=n+1){var r=t.slice(this.bufferPosition);if(n=r.indexOf(`
`),n===-1)break;var i=r.slice(0,n);i&&this.emit("message",i)}};_e.prototype._cleanup=function(){this.removeAllListeners()};_e.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()};var Fe=_e,Mn=N.EventEmitter,Oi=E,Pn=K,$i=M,ge=h.XMLHttpRequest,Ke=function(){};function W(e,t,n,r){var i=this;Mn.call(this),setTimeout(function(){i._start(e,t,n,r)},0)}Oi(W,Mn);W.prototype._start=function(e,t,n,r){var i=this;try{this.xhr=new ge}catch{}if(!this.xhr){this.emit("finish",0,"no xhr support"),this._cleanup();return}t=$i.addQuery(t,"t="+ +new Date),this.unloadRef=Pn.unloadAdd(function(){i._cleanup(!0)});try{this.xhr.open(e,t,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){Ke("xhr timeout"),i.emit("finish",0,""),i._cleanup(!1)})}catch{this.emit("finish",0,""),this._cleanup(!1);return}if((!r||!r.noCredentials)&&W.supportsCORS&&(this.xhr.withCredentials=!0),r&&r.headers)for(var o in r.headers)this.xhr.setRequestHeader(o,r.headers[o]);this.xhr.onreadystatechange=function(){if(i.xhr){var a=i.xhr,c,l;switch(Ke("readyState",a.readyState),a.readyState){case 3:try{l=a.status,c=a.responseText}catch{}l===1223&&(l=204),l===200&&c&&c.length>0&&i.emit("chunk",l,c);break;case 4:l=a.status,l===1223&&(l=204),(l===12005||l===12029)&&(l=0),Ke("finish",l,a.responseText),i.emit("finish",l,a.responseText),i._cleanup(!1);break}}};try{i.xhr.send(n)}catch{i.emit("finish",0,""),i._cleanup(!1)}};W.prototype._cleanup=function(e){if(this.xhr){if(this.removeAllListeners(),Pn.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),e)try{this.xhr.abort()}catch{}this.unloadRef=this.xhr=null}};W.prototype.close=function(){this._cleanup(!0)};W.enabled=!!ge;var Kt=["Active"].concat("Object").join("X");!W.enabled&&Kt in h&&(ge=function(){try{return new h[Kt]("Microsoft.XMLHTTP")}catch{return null}},W.enabled=!!new ge);var Dn=!1;try{Dn="withCredentials"in new ge}catch{}W.supportsCORS=Dn;var Bn=W,ki=E,Pe=Bn;function It(e,t,n,r){Pe.call(this,e,t,n,r)}ki(It,Pe);It.enabled=Pe.enabled&&Pe.supportsCORS;var Xe=It,Ri=E,Ot=Bn;function $t(e,t,n){Ot.call(this,e,t,n,{noCredentials:!0})}Ri($t,Ot);$t.enabled=Ot.enabled;var we=$t,Ee={isOpera:function(){return h.navigator&&/opera/i.test(h.navigator.userAgent)},isKonqueror:function(){return h.navigator&&/konqueror/i.test(h.navigator.userAgent)},hasDomain:function(){if(!h.document)return!0;try{return!!h.document.domain}catch{return!1}}},Ni=E,Hn=ce,Ai=Fe,pt=Xe,ji=we,Ui=Ee;function le(e){if(!ji.enabled&&!pt.enabled)throw new Error("Transport created when disabled");Hn.call(this,e,"/xhr_streaming",Ai,pt)}Ni(le,Hn);le.enabled=function(e){return e.nullOrigin||Ui.isOpera()?!1:pt.enabled};le.transportName="xhr-streaming";le.roundTrips=2;le.needBody=!!h.document;var Li=le,qn=N.EventEmitter,Mi=E,Wn=K,Pi=Ee,Di=M,Bi=function(){};function te(e,t,n){var r=this;qn.call(this),setTimeout(function(){r._start(e,t,n)},0)}Mi(te,qn);te.prototype._start=function(e,t,n){var r=this,i=new h.XDomainRequest;t=Di.addQuery(t,"t="+ +new Date),i.onerror=function(){r._error()},i.ontimeout=function(){r._error()},i.onprogress=function(){Bi("progress",i.responseText),r.emit("chunk",200,i.responseText)},i.onload=function(){r.emit("finish",200,i.responseText),r._cleanup(!1)},this.xdr=i,this.unloadRef=Wn.unloadAdd(function(){r._cleanup(!0)});try{this.xdr.open(e,t),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(n)}catch{this._error()}};te.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)};te.prototype._cleanup=function(e){if(this.xdr){if(this.removeAllListeners(),Wn.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,e)try{this.xdr.abort()}catch{}this.unloadRef=this.xdr=null}};te.prototype.close=function(){this._cleanup(!0)};te.enabled=!!(h.XDomainRequest&&Pi.hasDomain());var kt=te,Hi=E,Fn=ce,qi=Fe,mt=kt;function Se(e){if(!mt.enabled)throw new Error("Transport created when disabled");Fn.call(this,e,"/xhr_streaming",qi,mt)}Hi(Se,Fn);Se.enabled=function(e){return e.cookie_needed||e.nullOrigin?!1:mt.enabled&&e.sameScheme};Se.transportName="xdr-streaming";Se.roundTrips=2;var Xn=Se,Yn=h.EventSource,Wi=E,Jn=N.EventEmitter,Fi=Yn,Qt=function(){};function xe(e){Jn.call(this);var t=this,n=this.es=new Fi(e);n.onmessage=function(r){Qt("message",r.data),t.emit("message",decodeURI(r.data))},n.onerror=function(r){Qt("error",n.readyState);var i=n.readyState!==2?"network":"permanent";t._cleanup(),t._close(i)}}Wi(xe,Jn);xe.prototype.abort=function(){this._cleanup(),this._close("user")};xe.prototype._cleanup=function(){var e=this.es;e&&(e.onmessage=e.onerror=null,e.close(),this.es=null)};xe.prototype._close=function(e){var t=this;setTimeout(function(){t.emit("close",null,e),t.removeAllListeners()},200)};var Xi=xe,Yi=E,Gn=ce,Ji=Xi,Gi=Xe,zi=Yn;function fe(e){if(!fe.enabled())throw new Error("Transport created when disabled");Gn.call(this,e,"/eventsource",Ji,Gi)}Yi(fe,Gn);fe.enabled=function(){return!!zi};fe.transportName="eventsource";fe.roundTrips=2;var Zt=fe,Qe,en;function zn(){return en||(en=1,Qe="1.6.1"),Qe}var Vn={exports:{}};(function(e){var t=K,n=Ee;e.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){e.exports.WPrefix in h||(h[e.exports.WPrefix]={})},postMessage:function(r,i){h.parent!==h&&h.parent.postMessage(JSON.stringify({windowId:e.exports.currentWindowId,type:r,data:i||""}),"*")},createIframe:function(r,i){var o=h.document.createElement("iframe"),a,c,l=function(){clearTimeout(a);try{o.onload=null}catch{}o.onerror=null},u=function(){o&&(l(),setTimeout(function(){o&&o.parentNode.removeChild(o),o=null},0),t.unloadDel(c))},f=function(d){o&&(u(),i(d))},s=function(d,p){setTimeout(function(){try{o&&o.contentWindow&&o.contentWindow.postMessage(d,p)}catch{}},0)};return o.src=r,o.style.display="none",o.style.position="absolute",o.onerror=function(){f("onerror")},o.onload=function(){clearTimeout(a),a=setTimeout(function(){f("onload timeout")},2e3)},h.document.body.appendChild(o),a=setTimeout(function(){f("timeout")},15e3),c=t.unloadAdd(u),{post:s,cleanup:u,loaded:l}},createHtmlfile:function(r,i){var o=["Active"].concat("Object").join("X"),a=new h[o]("htmlfile"),c,l,u,f=function(){clearTimeout(c),u.onerror=null},s=function(){a&&(f(),t.unloadDel(l),u.parentNode.removeChild(u),u=a=null,CollectGarbage())},d=function(y){a&&(s(),i(y))},p=function(y,w){try{setTimeout(function(){u&&u.contentWindow&&u.contentWindow.postMessage(y,w)},0)}catch{}};a.open(),a.write('<html><script>document.domain="'+h.document.domain+'";<\/script></html>'),a.close(),a.parentWindow[e.exports.WPrefix]=h[e.exports.WPrefix];var g=a.createElement("div");return a.body.appendChild(g),u=a.createElement("iframe"),g.appendChild(u),u.src=r,u.onerror=function(){d("onerror")},c=setTimeout(function(){d("timeout")},15e3),l=t.unloadAdd(s),{post:p,cleanup:s,loaded:f}}},e.exports.iframeEnabled=!1,h.document&&(e.exports.iframeEnabled=(typeof h.postMessage=="function"||typeof h.postMessage=="object")&&!n.isKonqueror())})(Vn);var Ce=Vn.exports,Vi=E,Kn=N.EventEmitter,Ki=zn(),vt=M,Qn=Ce,Zn=K,Qi=ue,de=function(){};function F(e,t,n){if(!F.enabled())throw new Error("Transport created when disabled");Kn.call(this);var r=this;this.origin=vt.getOrigin(n),this.baseUrl=n,this.transUrl=t,this.transport=e,this.windowId=Qi.string(8);var i=vt.addPath(n,"/iframe.html")+"#"+this.windowId;this.iframeObj=Qn.createIframe(i,function(o){r.emit("close",1006,"Unable to load an iframe ("+o+")"),r.close()}),this.onmessageCallback=this._message.bind(this),Zn.attachEvent("message",this.onmessageCallback)}Vi(F,Kn);F.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){Zn.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch{}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}};F.prototype._message=function(e){if(de("message",e.data),!vt.isOriginEqual(e.origin,this.origin)){de("not same origin",e.origin,this.origin);return}var t;try{t=JSON.parse(e.data)}catch{de("bad json",e.data);return}if(t.windowId!==this.windowId){de("mismatched window id",t.windowId,this.windowId);return}switch(t.type){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([Ki,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",t.data);break;case"c":var n;try{n=JSON.parse(t.data)}catch{de("bad json",t.data);return}this.emit("close",n[0],n[1]),this.close();break}};F.prototype.postMessage=function(e,t){this.iframeObj.post(JSON.stringify({windowId:this.windowId,type:e,data:t||""}),this.origin)};F.prototype.send=function(e){this.postMessage("m",e)};F.enabled=function(){return Qn.iframeEnabled};F.transportName="iframe";F.roundTrips=2;var er=F,Rt={isObject:function(e){var t=typeof e;return t==="function"||t==="object"&&!!e},extend:function(e){if(!this.isObject(e))return e;for(var t,n,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}},Zi=E,Ae=er,eo=Rt,Ze=function(e){function t(n,r){Ae.call(this,e.transportName,n,r)}return Zi(t,Ae),t.enabled=function(n,r){if(!h.document)return!1;var i=eo.extend({},r);return i.sameOrigin=!0,e.enabled(i)&&Ae.enabled()},t.transportName="iframe-"+e.transportName,t.needBody=!0,t.roundTrips=Ae.roundTrips+e.roundTrips-1,t.facadeTransport=e,t},to=E,Z=Ce,no=M,tr=N.EventEmitter,ro=ue,io=function(){};function D(e){tr.call(this);var t=this;Z.polluteGlobalNamespace(),this.id="a"+ro.string(6),e=no.addQuery(e,"c="+decodeURIComponent(Z.WPrefix+"."+this.id)),io("using htmlfile",D.htmlfileEnabled);var n=D.htmlfileEnabled?Z.createHtmlfile:Z.createIframe;h[Z.WPrefix][this.id]={start:function(){t.iframeObj.loaded()},message:function(r){t.emit("message",r)},stop:function(){t._cleanup(),t._close("network")}},this.iframeObj=n(e,function(){t._cleanup(),t._close("permanent")})}to(D,tr);D.prototype.abort=function(){this._cleanup(),this._close("user")};D.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete h[Z.WPrefix][this.id]};D.prototype._close=function(e){this.emit("close",null,e),this.removeAllListeners()};D.htmlfileEnabled=!1;var tn=["Active"].concat("Object").join("X");if(tn in h)try{D.htmlfileEnabled=!!new h[tn]("htmlfile")}catch{}D.enabled=D.htmlfileEnabled||Z.iframeEnabled;var oo=D,so=E,gt=oo,ao=we,nr=ce;function Te(e){if(!gt.enabled)throw new Error("Transport created when disabled");nr.call(this,e,"/htmlfile",gt,ao)}so(Te,nr);Te.enabled=function(e){return gt.enabled&&e.sameOrigin};Te.transportName="htmlfile";Te.roundTrips=2;var nn=Te,uo=E,rr=ce,co=Fe,bt=Xe,ir=we;function Ie(e){if(!ir.enabled&&!bt.enabled)throw new Error("Transport created when disabled");rr.call(this,e,"/xhr",co,bt)}uo(Ie,rr);Ie.enabled=function(e){return e.nullOrigin?!1:ir.enabled&&e.sameOrigin?!0:bt.enabled};Ie.transportName="xhr-polling";Ie.roundTrips=2;var rn=Ie,lo=E,or=ce,fo=Xn,ho=Fe,on=kt;function Oe(e){if(!on.enabled)throw new Error("Transport created when disabled");or.call(this,e,"/xhr",ho,on)}lo(Oe,or);Oe.enabled=fo.enabled;Oe.transportName="xdr-polling";Oe.roundTrips=2;var po=Oe,me=Ce,sr=ue,mo=Ee,vo=M,go=E,ar=N.EventEmitter,bo=function(){};function L(e){var t=this;ar.call(this),me.polluteGlobalNamespace(),this.id="a"+sr.string(6);var n=vo.addQuery(e,"c="+encodeURIComponent(me.WPrefix+"."+this.id));h[me.WPrefix][this.id]=this._callback.bind(this),this._createScript(n),this.timeoutId=setTimeout(function(){t._abort(new Error("JSONP script loaded abnormally (timeout)"))},L.timeout)}go(L,ar);L.prototype.abort=function(){if(h[me.WPrefix][this.id]){var e=new Error("JSONP user aborted read");e.code=1e3,this._abort(e)}};L.timeout=35e3;L.scriptErrorTimeout=1e3;L.prototype._callback=function(e){this._cleanup(),!this.aborting&&(e&&this.emit("message",e),this.emit("close",null,"network"),this.removeAllListeners())};L.prototype._abort=function(e){this._cleanup(),this.aborting=!0,this.emit("close",e.code,e.message),this.removeAllListeners()};L.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var e=this.script;e.parentNode.removeChild(e),e.onreadystatechange=e.onerror=e.onload=e.onclick=null,this.script=null}delete h[me.WPrefix][this.id]};L.prototype._scriptError=function(){var e=this;this.errorTimer||(this.errorTimer=setTimeout(function(){e.loadedOkay||e._abort(new Error("JSONP script loaded abnormally (onerror)"))},L.scriptErrorTimeout))};L.prototype._createScript=function(e){var t=this,n=this.script=h.document.createElement("script"),r;if(n.id="a"+sr.string(8),n.src=e,n.type="text/javascript",n.charset="UTF-8",n.onerror=this._scriptError.bind(this),n.onload=function(){t._abort(new Error("JSONP script loaded abnormally (onload)"))},n.onreadystatechange=function(){if(bo("onreadystatechange",n.readyState),/loaded|closed/.test(n.readyState)){if(n&&n.htmlFor&&n.onclick){t.loadedOkay=!0;try{n.onclick()}catch{}}n&&t._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},typeof n.async>"u"&&h.document.attachEvent)if(mo.isOpera())r=this.script2=h.document.createElement("script"),r.text="try{var a = document.getElementById('"+n.id+"'); if(a)a.onerror();}catch(x){};",n.async=r.async=!1;else{try{n.htmlFor=n.id,n.event="onclick"}catch{}n.async=!0}typeof n.async<"u"&&(n.async=!0);var i=h.document.getElementsByTagName("head")[0];i.insertBefore(n,i.firstChild),r&&i.insertBefore(r,i.firstChild)};var yo=L,_o=ue,sn=M,wo=function(){},j,ve;function Eo(e){try{return h.document.createElement('<iframe name="'+e+'">')}catch{var t=h.document.createElement("iframe");return t.name=e,t}}function So(){j=h.document.createElement("form"),j.style.display="none",j.style.position="absolute",j.method="POST",j.enctype="application/x-www-form-urlencoded",j.acceptCharset="UTF-8",ve=h.document.createElement("textarea"),ve.name="d",j.appendChild(ve),h.document.body.appendChild(j)}var xo=function(e,t,n){j||So();var r="a"+_o.string(8);j.target=r,j.action=sn.addQuery(sn.addPath(e,"/jsonp_send"),"i="+r);var i=Eo(r);i.id=r,i.style.display="none",j.appendChild(i);try{ve.value=t}catch{}j.submit();var o=function(a){i.onerror&&(i.onreadystatechange=i.onerror=i.onload=null,setTimeout(function(){i.parentNode.removeChild(i),i=null},500),ve.value="",n(a))};return i.onerror=function(){o()},i.onload=function(){o()},i.onreadystatechange=function(a){wo("onreadystatechange",r,i.readyState),i.readyState==="complete"&&o()},function(){o(new Error("Aborted"))}},Co=E,ur=An,To=yo,Io=xo;function ne(e){if(!ne.enabled())throw new Error("Transport created when disabled");ur.call(this,e,"/jsonp",Io,To)}Co(ne,ur);ne.enabled=function(){return!!h.document};ne.transportName="jsonp-polling";ne.roundTrips=1;ne.needBody=!0;var Oo=ne,$o=[pi,Li,Xn,Zt,Ze(Zt),nn,Ze(nn),rn,po,Ze(rn),Oo],be=Array.prototype,Nt=Object.prototype,ko=Function.prototype,ye=String.prototype,et=be.slice,At=Nt.toString,cr=function(e){return Nt.toString.call(e)==="[object Function]"},Ro=function(t){return At.call(t)==="[object Array]"},lr=function(t){return At.call(t)==="[object String]"},No=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch{return!1}}(),yt;No?yt=function(e,t,n,r){!r&&t in e||Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:n})}:yt=function(e,t,n,r){!r&&t in e||(e[t]=n)};var $e=function(e,t,n){for(var r in t)Nt.hasOwnProperty.call(t,r)&&yt(e,r,t[r],n)},fr=function(e){if(e==null)throw new TypeError("can't convert "+e+" to object");return Object(e)};function Ao(e){var t=+e;return t!==t?t=0:t!==0&&t!==1/0&&t!==-1/0&&(t=(t>0||-1)*Math.floor(Math.abs(t))),t}function jo(e){return e>>>0}function tt(){}$e(ko,{bind:function(t){var n=this;if(!cr(n))throw new TypeError("Function.prototype.bind called on incompatible "+n);for(var r=et.call(arguments,1),i=function(){if(this instanceof l){var u=n.apply(this,r.concat(et.call(arguments)));return Object(u)===u?u:this}else return n.apply(t,r.concat(et.call(arguments)))},o=Math.max(0,n.length-r.length),a=[],c=0;c<o;c++)a.push("$"+c);var l=Function("binder","return function ("+a.join(",")+"){ return binder.apply(this, arguments); }")(i);return n.prototype&&(tt.prototype=n.prototype,l.prototype=new tt,tt.prototype=null),l}});$e(Array,{isArray:Ro});var an=Object("a"),hr=an[0]!=="a"||!(0 in an),Uo=function(t){var n=!0,r=!0;return t&&(t.call("foo",function(i,o,a){typeof a!="object"&&(n=!1)}),t.call([1],function(){r=typeof this=="string"},"x")),!!t&&n&&r};$e(be,{forEach:function(t){var n=fr(this),r=hr&&lr(this)?this.split(""):n,i=arguments[1],o=-1,a=r.length>>>0;if(!cr(t))throw new TypeError;for(;++o<a;)o in r&&t.call(i,r[o],o,n)}},!Uo(be.forEach));var Lo=Array.prototype.indexOf&&[0,1].indexOf(1,2)!==-1;$e(be,{indexOf:function(t){var n=hr&&lr(this)?this.split(""):fr(this),r=n.length>>>0;if(!r)return-1;var i=0;for(arguments.length>1&&(i=Ao(arguments[1])),i=i>=0?i:Math.max(0,r+i);i<r;i++)if(i in n&&n[i]===t)return i;return-1}},Lo);var un=ye.split;"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1?function(){var e=/()??/.exec("")[1]===void 0;ye.split=function(t,n){var r=this;if(t===void 0&&n===0)return[];if(At.call(t)!=="[object RegExp]")return un.call(this,t,n);var i=[],o=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.extended?"x":"")+(t.sticky?"y":""),a=0,c,l,u,f;for(t=new RegExp(t.source,o+"g"),r+="",e||(c=new RegExp("^"+t.source+"$(?!\\s)",o)),n=n===void 0?-1>>>0:jo(n);(l=t.exec(r))&&(u=l.index+l[0].length,!(u>a&&(i.push(r.slice(a,l.index)),!e&&l.length>1&&l[0].replace(c,function(){for(var s=1;s<arguments.length-2;s++)arguments[s]===void 0&&(l[s]=void 0)}),l.length>1&&l.index<r.length&&be.push.apply(i,l.slice(1)),f=l[0].length,a=u,i.length>=n)));)t.lastIndex===l.index&&t.lastIndex++;return a===r.length?(f||!t.test(""))&&i.push(""):i.push(r.slice(a)),i.length>n?i.slice(0,n):i}}():"0".split(void 0,0).length&&(ye.split=function(t,n){return t===void 0&&n===0?[]:un.call(this,t,n)});var Mo=ye.substr,Po="".substr&&"0b".substr(-1)!=="b";$e(ye,{substr:function(t,n){return Mo.call(this,t<0&&(t=this.length+t)<0?0:t,n)}},Po);var je=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,nt,Do=function(e){var t,n={},r=[];for(t=0;t<65536;t++)r.push(String.fromCharCode(t));return e.lastIndex=0,r.join("").replace(e,function(i){return n[i]="\\u"+("0000"+i.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,n},Bo={quote:function(e){var t=JSON.stringify(e);return je.lastIndex=0,je.test(t)?(nt||(nt=Do(je)),t.replace(je,function(n){return nt[n]})):t}},rt=function(){},Ho=function(e){return{filterToEnabled:function(t,n){var r={main:[],facade:[]};return t?typeof t=="string"&&(t=[t]):t=[],e.forEach(function(i){if(i&&!(i.transportName==="websocket"&&n.websocket===!1)){if(t.length&&t.indexOf(i.transportName)===-1){rt("not in whitelist",i.transportName);return}i.enabled(n)?(rt("enabled",i.transportName),r.main.push(i),i.facadeTransport&&r.facade.push(i.facadeTransport)):rt("disabled",i.transportName)}}),r}}},_t={};["log","debug","warn"].forEach(function(e){var t;try{t=h.console&&h.console[e]&&h.console[e].apply}catch{}_t[e]=t?function(){return h.console[e].apply(h.console,arguments)}:e==="log"?function(){}:_t.log});var qo=_t;function re(e){this.type=e}re.prototype.initEvent=function(e,t,n){return this.type=e,this.bubbles=t,this.cancelable=n,this.timeStamp=+new Date,this};re.prototype.stopPropagation=function(){};re.prototype.preventDefault=function(){};re.CAPTURING_PHASE=1;re.AT_TARGET=2;re.BUBBLING_PHASE=3;var jt=re,dr=h.location||{protocol:"http:",href:"http://localhost/",hash:""},Wo=E,pr=jt;function mr(){pr.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}Wo(mr,pr);var Fo=mr,Xo=E,vr=jt;function gr(e){vr.call(this),this.initEvent("message",!1,!1),this.data=e}Xo(gr,vr);var Yo=gr,br=N.EventEmitter,Jo=E;function ke(){var e=this;br.call(this),this.to=setTimeout(function(){e.emit("finish",200,"{}")},ke.timeout)}Jo(ke,br);ke.prototype.close=function(){clearTimeout(this.to)};ke.timeout=2e3;var Go=ke,yr=N.EventEmitter,zo=E,Vo=Rt;function Ut(e,t){yr.call(this);var n=this,r=+new Date;this.xo=new t("GET",e),this.xo.once("finish",function(i,o){var a,c;if(i===200){if(c=+new Date-r,o)try{a=JSON.parse(o)}catch{}Vo.isObject(a)||(a={})}n.emit("finish",a,c),n.removeAllListeners()})}zo(Ut,yr);Ut.prototype.close=function(){this.removeAllListeners(),this.xo.close()};var _r=Ut,it,cn;function wr(){if(cn)return it;cn=1;var e=E,t=N.EventEmitter,n=we,r=_r;function i(o){var a=this;t.call(this),this.ir=new r(o,n),this.ir.once("finish",function(c,l){a.ir=null,a.emit("message",JSON.stringify([c,l]))})}return e(i,t),i.transportName="iframe-info-receiver",i.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},it=i,it}var Er=N.EventEmitter,Ko=E,Qo=K,Sr=er,Zo=wr();function Ye(e,t){var n=this;Er.call(this);var r=function(){var i=n.ifr=new Sr(Zo.transportName,t,e);i.once("message",function(o){if(o){var a;try{a=JSON.parse(o)}catch{n.emit("finish"),n.close();return}var c=a[0],l=a[1];n.emit("finish",c,l)}n.close()}),i.once("close",function(){n.emit("finish"),n.close()})};h.document.body?r():Qo.attachEvent("load",r)}Ko(Ye,Er);Ye.enabled=function(){return Sr.enabled()};Ye.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null};var es=Ye,xr=N.EventEmitter,ts=E,ns=M,ln=kt,fn=Xe,rs=we,is=Go,hn=es,Ue=_r;function J(e,t){var n=this;xr.call(this),setTimeout(function(){n.doXhr(e,t)},0)}ts(J,xr);J._getReceiver=function(e,t,n){return n.sameOrigin?new Ue(t,rs):fn.enabled?new Ue(t,fn):ln.enabled&&n.sameScheme?new Ue(t,ln):hn.enabled()?new hn(e,t):new Ue(t,is)};J.prototype.doXhr=function(e,t){var n=this,r=ns.addPath(e,"/info");this.xo=J._getReceiver(e,r,t),this.timeoutRef=setTimeout(function(){n._cleanup(!1),n.emit("finish")},J.timeout),this.xo.once("finish",function(i,o){n._cleanup(!0),n.emit("finish",i,o)})};J.prototype._cleanup=function(e){clearTimeout(this.timeoutRef),this.timeoutRef=null,!e&&this.xo&&this.xo.close(),this.xo=null};J.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)};J.timeout=8e3;var os=J,ot,dn;function ss(){if(dn)return ot;dn=1;var e=Ce;function t(n){this._transport=n,n.on("message",this._transportMessage.bind(this)),n.on("close",this._transportClose.bind(this))}return t.prototype._transportClose=function(n,r){e.postMessage("c",JSON.stringify([n,r]))},t.prototype._transportMessage=function(n){e.postMessage("t",n)},t.prototype._send=function(n){this._transport.send(n)},t.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},ot=t,ot}var st,pn;function as(){if(pn)return st;pn=1;var e=M,t=K,n=ss(),r=wr(),i=Ce,o=dr,a=function(){};return st=function(c,l){var u={};l.forEach(function(s){s.facadeTransport&&(u[s.facadeTransport.transportName]=s.facadeTransport)}),u[r.transportName]=r;var f;c.bootstrap_iframe=function(){var s;i.currentWindowId=o.hash.slice(1);var d=function(p){if(p.source===parent&&(typeof f>"u"&&(f=p.origin),p.origin===f)){var g;try{g=JSON.parse(p.data)}catch{a("bad json",p.data);return}if(g.windowId===i.currentWindowId)switch(g.type){case"s":var y;try{y=JSON.parse(g.data)}catch{a("bad json",g.data);break}var w=y[0],x=y[1],T=y[2],b=y[3];if(w!==c.version)throw new Error('Incompatible SockJS! Main site uses: "'+w+'", the iframe: "'+c.version+'".');if(!e.isOriginEqual(T,o.href)||!e.isOriginEqual(b,o.href))throw new Error("Can't connect to different domain from within an iframe. ("+o.href+", "+T+", "+b+")");s=new n(new u[x](T,b));break;case"m":s._send(g.data);break;case"c":s&&s._close(),s=null;break}}};t.attachEvent("message",d),i.postMessage("s")}},st}var us=Tn,cs=E,mn=ue,ls=Bo,pe=M,fs=K,hs=Ho,ds=Rt,ps=Ee,ms=qo,Lt=jt,Cr=In,Le=dr,vs=Fo,vn=Yo,gs=os,H=function(){},Tr;function _(e,t,n){if(!(this instanceof _))return new _(e,t,n);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");Cr.call(this),this.readyState=_.CONNECTING,this.extensions="",this.protocol="",n=n||{},n.protocols_whitelist&&ms.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=n.transports,this._transportOptions=n.transportOptions||{},this._timeout=n.timeout||0;var r=n.sessionId||8;if(typeof r=="function")this._generateSessionId=r;else if(typeof r=="number")this._generateSessionId=function(){return mn.string(r)};else throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._server=n.server||mn.numberString(1e3);var i=new us(e);if(!i.host||!i.protocol)throw new SyntaxError("The URL '"+e+"' is invalid");if(i.hash)throw new SyntaxError("The URL must not contain a fragment");if(i.protocol!=="http:"&&i.protocol!=="https:")throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+i.protocol+"' is not allowed.");var o=i.protocol==="https:";if(Le.protocol==="https:"&&!o&&!pe.isLoopbackAddr(i.hostname))throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");t?Array.isArray(t)||(t=[t]):t=[];var a=t.sort();a.forEach(function(l,u){if(!l)throw new SyntaxError("The protocols entry '"+l+"' is invalid.");if(u<a.length-1&&l===a[u+1])throw new SyntaxError("The protocols entry '"+l+"' is duplicated.")});var c=pe.getOrigin(Le.href);this._origin=c?c.toLowerCase():null,i.set("pathname",i.pathname.replace(/\/+$/,"")),this.url=i.href,H("using url",this.url),this._urlInfo={nullOrigin:!ps.hasDomain(),sameOrigin:pe.isOriginEqual(this.url,Le.href),sameScheme:pe.isSchemeEqual(this.url,Le.href)},this._ir=new gs(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}cs(_,Cr);function Ir(e){return e===1e3||e>=3e3&&e<=4999}_.prototype.close=function(e,t){if(e&&!Ir(e))throw new Error("InvalidAccessError: Invalid code");if(t&&t.length>123)throw new SyntaxError("reason argument has an invalid length");if(!(this.readyState===_.CLOSING||this.readyState===_.CLOSED)){var n=!0;this._close(e||1e3,t||"Normal closure",n)}};_.prototype.send=function(e){if(typeof e!="string"&&(e=""+e),this.readyState===_.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===_.OPEN&&this._transport.send(ls.quote(e))};_.version=zn();_.CONNECTING=0;_.OPEN=1;_.CLOSING=2;_.CLOSED=3;_.prototype._receiveInfo=function(e,t){if(this._ir=null,!e){this._close(1002,"Cannot connect to server");return}this._rto=this.countRTO(t),this._transUrl=e.base_url?e.base_url:this.url,e=ds.extend(e,this._urlInfo);var n=Tr.filterToEnabled(this._transportsWhitelist,e);this._transports=n.main,H(this._transports.length+" enabled transports"),this._connect()};_.prototype._connect=function(){for(var e=this._transports.shift();e;e=this._transports.shift()){if(H("attempt",e.transportName),e.needBody&&(!h.document.body||typeof h.document.readyState<"u"&&h.document.readyState!=="complete"&&h.document.readyState!=="interactive")){this._transports.unshift(e),fs.attachEvent("load",this._connect.bind(this));return}var t=Math.max(this._timeout,this._rto*e.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),t);var n=pe.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),r=this._transportOptions[e.transportName],i=new e(n,this._transUrl,r);i.on("message",this._transportMessage.bind(this)),i.once("close",this._transportClose.bind(this)),i.transportName=e.transportName,this._transport=i;return}this._close(2e3,"All transports failed",!1)};_.prototype._transportTimeout=function(){this.readyState===_.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))};_.prototype._transportMessage=function(e){var t=this,n=e.slice(0,1),r=e.slice(1),i;switch(n){case"o":this._open();return;case"h":this.dispatchEvent(new Lt("heartbeat")),H("heartbeat",this.transport);return}if(r)try{i=JSON.parse(r)}catch{}if(!(typeof i>"u"))switch(n){case"a":Array.isArray(i)&&i.forEach(function(o){H("message",t.transport),t.dispatchEvent(new vn(o))});break;case"m":H("message",this.transport),this.dispatchEvent(new vn(i));break;case"c":Array.isArray(i)&&i.length===2&&this._close(i[0],i[1],!0);break}};_.prototype._transportClose=function(e,t){if(H("_transportClose",this.transport),this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),!Ir(e)&&e!==2e3&&this.readyState===_.CONNECTING){this._connect();return}this._close(e,t)};_.prototype._open=function(){H("_open",this._transport&&this._transport.transportName,this.readyState),this.readyState===_.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=_.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new Lt("open")),H("connected",this.transport)):this._close(1006,"Server lost session")};_.prototype._close=function(e,t,n){H("_close",this.transport,e,t,n,this.readyState);var r=!1;if(this._ir&&(r=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===_.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=_.CLOSING,setTimeout((function(){this.readyState=_.CLOSED,r&&this.dispatchEvent(new Lt("error"));var i=new vs;i.wasClean=n||!1,i.code=e||1e3,i.reason=t,this.dispatchEvent(i),this.onmessage=this.onclose=this.onerror=null}).bind(this),0)};_.prototype.countRTO=function(e){return e>100?4*e:300+e};var bs=function(e){return Tr=hs(e),as()(_,e),_},ys=$o,_s=bs(ys);"_sockjs_onload"in h&&setTimeout(h._sockjs_onload,1);const ws=Et(_s);var Je={exports:{}},Mt={};(function(e){(function(){var t,n,r,i,o={}.hasOwnProperty,a=[].slice;t={LF:`
`,NULL:"\0"},r=function(){var c;function l(u,f,s){this.command=u,this.headers=f??{},this.body=s??""}return l.prototype.toString=function(){var u,f,s,d,p;u=[this.command],s=this.headers["content-length"]===!1,s&&delete this.headers["content-length"],p=this.headers;for(f in p)o.call(p,f)&&(d=p[f],u.push(""+f+":"+d));return this.body&&!s&&u.push("content-length:"+l.sizeOfUTF8(this.body)),u.push(t.LF+this.body),u.join(t.LF)},l.sizeOfUTF8=function(u){return u?encodeURI(u).match(/%..|./g).length:0},c=function(u){var f,s,d,p,g,y,w,x,T,b,I,$,k,R,P,m,v;for(p=u.search(RegExp(""+t.LF+t.LF)),g=u.substring(0,p).split(t.LF),d=g.shift(),y={},$=function(S){return S.replace(/^\s+|\s+$/g,"")},m=g.reverse(),k=0,P=m.length;k<P;k++)b=m[k],x=b.indexOf(":"),y[$(b.substring(0,x))]=$(b.substring(x+1));if(f="",I=p+2,y["content-length"])T=parseInt(y["content-length"]),f=(""+u).substring(I,I+T);else for(s=null,w=R=I,v=u.length;(I<=v?R<v:R>v)&&(s=u.charAt(w),s!==t.NULL);w=I<=v?++R:--R)f+=s;return new l(d,y,f)},l.unmarshall=function(u){var f;return function(){var s,d,p,g;for(p=u.split(RegExp(""+t.NULL+t.LF+"*")),g=[],s=0,d=p.length;s<d;s++)f=p[s],(f!=null?f.length:void 0)>0&&g.push(c(f));return g}()},l.marshall=function(u,f,s){var d;return d=new l(u,f,s),d.toString()+t.NULL},l}(),n=function(){var c;function l(u){this.ws=u,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16*1024,this.subscriptions={}}return l.prototype.debug=function(u){var f;return typeof window<"u"&&window!==null&&(f=window.console)!=null?f.log(u):void 0},c=function(){return Date.now?Date.now():new Date().valueOf},l.prototype._transmit=function(u,f,s){var d;for(d=r.marshall(u,f,s),typeof this.debug=="function"&&this.debug(">>> "+d);;)if(d.length>this.maxWebSocketFrameSize)this.ws.send(d.substring(0,this.maxWebSocketFrameSize)),d=d.substring(this.maxWebSocketFrameSize),typeof this.debug=="function"&&this.debug("remaining = "+d.length);else return this.ws.send(d)},l.prototype._setupHeartbeat=function(u){var f,s,d,p,g,y;if(!((g=u.version)!==i.VERSIONS.V1_1&&g!==i.VERSIONS.V1_2)&&(y=function(){var w,x,T,b;for(T=u["heart-beat"].split(","),b=[],w=0,x=T.length;w<x;w++)p=T[w],b.push(parseInt(p));return b}(),s=y[0],f=y[1],this.heartbeat.outgoing===0||f===0||(d=Math.max(this.heartbeat.outgoing,f),typeof this.debug=="function"&&this.debug("send PING every "+d+"ms"),this.pinger=i.setInterval(d,function(w){return function(){return w.ws.send(t.LF),typeof w.debug=="function"?w.debug(">>> PING"):void 0}}(this))),!(this.heartbeat.incoming===0||s===0)))return d=Math.max(this.heartbeat.incoming,s),typeof this.debug=="function"&&this.debug("check PONG every "+d+"ms"),this.ponger=i.setInterval(d,function(w){return function(){var x;if(x=c()-w.serverActivity,x>d*2)return typeof w.debug=="function"&&w.debug("did not receive server activity for the last "+x+"ms"),w.ws.close()}}(this))},l.prototype._parseConnect=function(){var u,f,s,d;switch(u=1<=arguments.length?a.call(arguments,0):[],d={},u.length){case 2:d=u[0],f=u[1];break;case 3:u[1]instanceof Function?(d=u[0],f=u[1],s=u[2]):(d.login=u[0],d.passcode=u[1],f=u[2]);break;case 4:d.login=u[0],d.passcode=u[1],f=u[2],s=u[3];break;default:d.login=u[0],d.passcode=u[1],f=u[2],s=u[3],d.host=u[4]}return[d,f,s]},l.prototype.connect=function(){var u,f,s,d;return u=1<=arguments.length?a.call(arguments,0):[],d=this._parseConnect.apply(this,u),s=d[0],this.connectCallback=d[1],f=d[2],typeof this.debug=="function"&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(p){return function(g){var y,w,x,T,b,I,$,k,R,P,m,v;if(T=typeof ArrayBuffer<"u"&&g.data instanceof ArrayBuffer?(y=new Uint8Array(g.data),typeof p.debug=="function"&&p.debug("--- got data length: "+y.length),function(){var S,ie,oe;for(oe=[],S=0,ie=y.length;S<ie;S++)w=y[S],oe.push(String.fromCharCode(w));return oe}().join("")):g.data,p.serverActivity=c(),T===t.LF){typeof p.debug=="function"&&p.debug("<<< PONG");return}for(typeof p.debug=="function"&&p.debug("<<< "+T),m=r.unmarshall(T),v=[],R=0,P=m.length;R<P;R++)switch(b=m[R],b.command){case"CONNECTED":typeof p.debug=="function"&&p.debug("connected to server "+b.headers.server),p.connected=!0,p._setupHeartbeat(b.headers),v.push(typeof p.connectCallback=="function"?p.connectCallback(b):void 0);break;case"MESSAGE":k=b.headers.subscription,$=p.subscriptions[k]||p.onreceive,$?(x=p,I=b.headers["message-id"],b.ack=function(S){return S==null&&(S={}),x.ack(I,k,S)},b.nack=function(S){return S==null&&(S={}),x.nack(I,k,S)},v.push($(b))):v.push(typeof p.debug=="function"?p.debug("Unhandled received MESSAGE: "+b):void 0);break;case"RECEIPT":v.push(typeof p.onreceipt=="function"?p.onreceipt(b):void 0);break;case"ERROR":v.push(typeof f=="function"?f(b):void 0);break;default:v.push(typeof p.debug=="function"?p.debug("Unhandled frame: "+b):void 0)}return v}}(this),this.ws.onclose=function(p){return function(){var g;return g="Whoops! Lost connection to "+p.ws.url,typeof p.debug=="function"&&p.debug(g),p._cleanUp(),typeof f=="function"?f(g):void 0}}(this),this.ws.onopen=function(p){return function(){return typeof p.debug=="function"&&p.debug("Web Socket Opened..."),s["accept-version"]=i.VERSIONS.supportedVersions(),s["heart-beat"]=[p.heartbeat.outgoing,p.heartbeat.incoming].join(","),p._transmit("CONNECT",s)}}(this)},l.prototype.disconnect=function(u,f){return f==null&&(f={}),this._transmit("DISCONNECT",f),this.ws.onclose=null,this.ws.close(),this._cleanUp(),typeof u=="function"?u():void 0},l.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&i.clearInterval(this.pinger),this.ponger)return i.clearInterval(this.ponger)},l.prototype.send=function(u,f,s){return f==null&&(f={}),s==null&&(s=""),f.destination=u,this._transmit("SEND",f,s)},l.prototype.subscribe=function(u,f,s){var d;return s==null&&(s={}),s.id||(s.id="sub-"+this.counter++),s.destination=u,this.subscriptions[s.id]=f,this._transmit("SUBSCRIBE",s),d=this,{id:s.id,unsubscribe:function(){return d.unsubscribe(s.id)}}},l.prototype.unsubscribe=function(u){return delete this.subscriptions[u],this._transmit("UNSUBSCRIBE",{id:u})},l.prototype.begin=function(u){var f,s;return s=u||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:s}),f=this,{id:s,commit:function(){return f.commit(s)},abort:function(){return f.abort(s)}}},l.prototype.commit=function(u){return this._transmit("COMMIT",{transaction:u})},l.prototype.abort=function(u){return this._transmit("ABORT",{transaction:u})},l.prototype.ack=function(u,f,s){return s==null&&(s={}),s["message-id"]=u,s.subscription=f,this._transmit("ACK",s)},l.prototype.nack=function(u,f,s){return s==null&&(s={}),s["message-id"]=u,s.subscription=f,this._transmit("NACK",s)},l}(),i={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(c,l){var u,f;return l==null&&(l=["v10.stomp","v11.stomp"]),u=i.WebSocketClass||WebSocket,f=new u(c,l),new n(f)},over:function(c){return new n(c)},Frame:r},e!==null&&(e.Stomp=i),typeof window<"u"&&window!==null?(i.setInterval=function(c,l){return window.setInterval(l,c)},i.clearInterval=function(c){return window.clearInterval(c)},window.Stomp=i):e||(self.Stomp=i)}).call(h)})(Mt);var wt={};const Es={},Ss=Object.freeze(Object.defineProperty({__proto__:null,default:Es},Symbol.toStringTag,{value:"Module"})),xs=Ar(Ss);var at,gn;function Cs(){if(gn)return at;gn=1;var e=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return at=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return e()}try{return __global__||e()}finally{delete Object.prototype.__global__}}(),at}const Ts="1.0.35",Is={version:Ts};var ut,bn;function Os(){return bn||(bn=1,ut=Is.version),ut}var ct,yn;function $s(){if(yn)return ct;yn=1;var e;if(typeof globalThis=="object")e=globalThis;else try{e=Cs()}catch{}finally{if(!e&&typeof window<"u"&&(e=window),!e)throw new Error("Could not determine global this")}var t=e.WebSocket||e.MozWebSocket,n=Os();function r(i,o){var a;return o?a=new t(i,o):a=new t(i),a}return t&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(i){Object.defineProperty(r,i,{get:function(){return t[i]}})}),ct={w3cwebsocket:t?r:null,version:n},ct}(function(){var e,t,n,r,i,o;e=Mt,t=xs,e.Stomp.setInterval=function(a,c){return setInterval(c,a)},e.Stomp.clearInterval=function(a){return clearInterval(a)},i=function(a,c){var l,u;return l=null,u={url:"tcp:// "+c+":"+a,send:function(f){return l.write(f)},close:function(){return l.end()}},l=t.connect(a,c,function(f){return u.onopen()}),l.on("error",function(f){return typeof u.onclose=="function"?u.onclose(f):void 0}),l.on("close",function(f){return typeof u.onclose=="function"?u.onclose(f):void 0}),l.on("data",function(f){var s;return s={data:f.toString()},u.onmessage(s)}),u},o=function(a){var c,l,u,f;return c=$s().client,l=null,f={url:a,send:function(s){return l.sendUTF(s)},close:function(){return l.close()}},u=new c,u.on("connect",function(s){return l=s,f.onopen(),l.on("error",function(d){return typeof f.onclose=="function"?f.onclose(d):void 0}),l.on("close",function(){return typeof f.onclose=="function"?f.onclose():void 0}),l.on("message",function(d){var p;if(d.type==="utf8")return p={data:d.utf8Data},f.onmessage(p)})}),u.connect(a),f},n=function(a,c){var l;return l=i(c,a),e.Stomp.over(l)},r=function(a){var c;return c=o(a),e.Stomp.over(c)},wt.overTCP=n,wt.overWS=r}).call(h);var ks=Mt,Or=wt;Je.exports=ks.Stomp;Je.exports.overTCP=Or.overTCP;Je.exports.overWS=Or.overWS;var Rs=Je.exports;const Ns=Et(Rs);class As{constructor(){this.stompClient=null,this.connected=!1,this.subscriptions={},this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.messageHandlers=[],this.readHandlers=[]}connect(t){return new Promise((n,r)=>{if(this.connected){n();return}const i="",o=new ws(`${i}/ws`);this.stompClient=Ns.over(o),this.stompClient.debug=null;const a={Authorization:`Bearer ${t}`};this.stompClient.connect(a,()=>{this.connected=!0,this.reconnectAttempts=0,console.log("WebSocket connected"),this.subscribeToMessages(),this.subscribeToReadNotifications(),n()},c=>{console.error("WebSocket connection error:",c),this.connected=!1,this.handleReconnect(t),r(c)})})}subscribeToMessages(){this.subscriptions.messages&&this.subscriptions.messages.unsubscribe(),this.subscriptions.messages=this.stompClient.subscribe("/user/queue/messages",t=>{const n=JSON.parse(t.body);this.messageHandlers.forEach(r=>r(n))})}subscribeToReadNotifications(){this.subscriptions.read&&this.subscriptions.read.unsubscribe(),this.subscriptions.read=this.stompClient.subscribe("/user/queue/read",t=>{const n=JSON.parse(t.body);this.readHandlers.forEach(r=>r(n))})}sendMessage(t,n,r=1){return!this.connected||!this.stompClient?(console.error("WebSocket not connected"),!1):(this.stompClient.send("/app/chat.send",{},JSON.stringify({toUserId:t,content:n,type:r})),!0)}markAsRead(t){return!this.connected||!this.stompClient?!1:(this.stompClient.send("/app/chat.read",{},JSON.stringify(t)),!0)}onMessage(t){return this.messageHandlers.push(t),()=>{const n=this.messageHandlers.indexOf(t);n>-1&&this.messageHandlers.splice(n,1)}}onRead(t){return this.readHandlers.push(t),()=>{const n=this.readHandlers.indexOf(t);n>-1&&this.readHandlers.splice(n,1)}}handleReconnect(t){this.reconnectAttempts<this.maxReconnectAttempts&&(this.reconnectAttempts++,console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect(t)},this.reconnectDelay))}disconnect(){this.stompClient&&(Object.values(this.subscriptions).forEach(t=>{t&&t.unsubscribe()}),this.subscriptions={},this.stompClient.disconnect(),this.stompClient=null),this.connected=!1,this.messageHandlers=[],this.readHandlers=[]}isConnected(){return this.connected}}const ae=new As;var $r={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(h,function(){return function(n,r,i){n=n||{};var o=r.prototype,a={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function c(u,f,s,d){return o.fromToBase(u,f,s,d)}i.en.relativeTime=a,o.fromToBase=function(u,f,s,d,p){for(var g,y,w,x=s.$locale().relativeTime||a,T=n.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],b=T.length,I=0;I<b;I+=1){var $=T[I];$.d&&(g=d?i(u).diff(s,$.d,!0):s.diff(u,$.d,!0));var k=(n.rounding||Math.round)(Math.abs(g));if(w=g>0,k<=$.r||!$.r){k<=1&&I>0&&($=T[I-1]);var R=x[$.l];p&&(k=p(""+k)),y=typeof R=="string"?R.replace("%d",k):R(k,f,$.l,w);break}}if(f)return y;var P=w?x.future:x.past;return typeof P=="function"?P(y):P.replace("%s",y)},o.to=function(u,f){return c(u,f,this,!0)},o.from=function(u,f){return c(u,f,this)};var l=function(u){return u.$u?i.utc():i()};o.toNow=function(u){return this.to(l(this),u)},o.fromNow=function(u){return this.from(l(this),u)}}})})($r);var js=$r.exports;const Us=Et(js);var Ls={exports:{}};(function(e,t){(function(n,r){e.exports=r(jr)})(h,function(n){function r(a){return a&&typeof a=="object"&&"default"in a?a:{default:a}}var i=r(n),o={name:"zh-cn",weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),ordinal:function(a,c){return c==="W"?a+"":a+""},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMDAhmm",LLLL:"YYYYMDddddAhmm",l:"YYYY/M/D",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMDdddd HH:mm"},relativeTime:{future:"%s",past:"%s",s:"",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "},meridiem:function(a,c){var l=100*a+c;return l<600?"":l<900?"":l<1100?"":l<1300?"":l<1800?"":""}};return i.default.locale(o,null,!0),o})})(Ls);const Ms={class:"chat-container"},Ps={class:"chat-sidebar"},Ds={class:"conversation-list"},Bs=["onClick"],Hs={class:"conv-info"},qs={class:"conv-header"},Ws={class:"conv-name"},Fs={class:"conv-time"},Xs={class:"conv-preview"},Ys={class:"last-message"},Js={class:"chat-main"},Gs={class:"chat-header"},zs={class:"header-info"},Vs={class:"header-name"},Ks={class:"header-status"},Qs={class:"header-actions"},Zs={key:0,class:"loading-more"},ea={class:"message-content"},ta={class:"message-bubble"},na={class:"message-time"},ra={class:"chat-input"},ia={class:"input-actions"},oa={key:1,class:"chat-empty"},Me="/default-avatar.png",sa={__name:"Chat",setup(e){he.extend(Us),he.locale("zh-cn");const t=Br(),n=qr(),r=Yr(),i=Y([]),o=Y(null),a=Y([]),c=Y(""),l=Y(null),u=Y(!1),f=Y(!1),s=Y(1),d=Y(!0),p=Xr(()=>{var m;return((m=r.userInfo)==null?void 0:m.avatar)||Me}),g=async()=>{try{const m=await Gr();if(m.code===200){i.value=m.data||[];const v=t.query.userId;if(v){const S=i.value.find(ie=>ie.otherUserId==v);S?y(S):o.value={conversationId:null,otherUserId:parseInt(v),otherUserNickname:t.query.nickname||"",otherUserAvatar:t.query.avatar||null,unreadCount:0}}}}catch(m){console.error(":",m)}},y=async m=>{o.value=m,a.value=[],s.value=1,d.value=!0,await w(),m.unreadCount>0&&(await Ft(m.otherUserId),m.unreadCount=0,ae.markAsRead(m.otherUserId)),b()},w=async()=>{if(!(!o.value||u.value||!d.value)){u.value=!0;try{const m=await zr(o.value.otherUserId,{pageNum:s.value,pageSize:20});if(m.code===200){const v=m.data.records||[];v.length<20&&(d.value=!1),a.value=[...v.reverse(),...a.value],s.value++}}catch(m){console.error(":",m)}finally{u.value=!1}}},x=async()=>{const m=c.value.trim();if(!(!m||!o.value)){if(f.value)ae.sendMessage(o.value.otherUserId,m,1);else try{await Jr({toUserId:o.value.otherUserId,content:m,type:1}),a.value.push({id:Date.now(),content:m,type:1,isSelf:!0,createTime:new Date().toISOString()}),b()}catch{Wt.error("");return}c.value=""}},T=m=>(Wt.info(""),!1),b=()=>{Hr(()=>{l.value&&(l.value.scrollTop=l.value.scrollHeight)})},I=m=>m?he(m).fromNow():"",$=m=>{if(!m)return"";const v=he(m),S=he();return v.isSame(S,"day")?v.format("HH:mm"):v.isSame(S,"year")?v.format("MM-DD HH:mm"):v.format("YYYY-MM-DD HH:mm")},k=()=>{o.value&&n.push(`/user/${o.value.otherUserId}`)},R=m=>{if(o.value&&(m.fromUserId===o.value.otherUserId||m.isSelf))a.value.push(m),b(),m.isSelf||(Ft(o.value.otherUserId),ae.markAsRead(o.value.otherUserId));else{const v=i.value.find(S=>S.otherUserId===m.fromUserId);v?(v.unreadCount=(v.unreadCount||0)+1,v.lastMessageContent=m.content,v.lastMessageTime=m.createTime):g()}},P=async()=>{const m=r.token;if(m)try{await ae.connect(m),f.value=!0,ae.onMessage(R),ae.onRead(v=>{})}catch(v){console.error("WebSocket:",v),f.value=!1}};return Lr(()=>{g(),P()}),Mr(()=>{}),(m,v)=>{const S=z("el-avatar"),ie=z("el-badge"),oe=z("el-empty"),Ge=z("el-button"),Pt=z("el-icon"),kr=z("el-image"),Rr=z("el-input"),Nr=z("el-upload");return U(),X("div",Ms,[C("div",Ps,[v[1]||(v[1]=C("div",{class:"sidebar-header"},[C("h3",null,"")],-1)),C("div",Ds,[(U(!0),X(Re,null,Bt(i.value,O=>{var Dt;return U(),X("div",{key:O.conversationId,class:Ht(["conversation-item",{active:((Dt=o.value)==null?void 0:Dt.conversationId)===O.conversationId}]),onClick:aa=>y(O)},[A(S,{size:48,src:O.otherUserAvatar||Me},null,8,["src"]),C("div",Hs,[C("div",qs,[C("span",Ws,Q(O.otherUserNickname),1),C("span",Fs,Q(I(O.lastMessageTime)),1)]),C("div",Xs,[C("span",Ys,Q(O.lastMessageContent),1),O.unreadCount>0?(U(),ze(ie,{key:0,value:O.unreadCount,class:"unread-badge"},null,8,["value"])):Ve("",!0)])])],10,Bs)}),128)),i.value.length===0?(U(),ze(oe,{key:0,description:""})):Ve("",!0)])]),C("div",Js,[o.value?(U(),X(Re,{key:0},[C("div",Gs,[A(S,{size:40,src:o.value.otherUserAvatar||Me},null,8,["src"]),C("div",zs,[C("span",Vs,Q(o.value.otherUserNickname),1),C("span",Ks,Q(f.value?"":""),1)]),C("div",Qs,[A(Ge,{type:"primary",link:"",onClick:k},{default:se(()=>[...v[2]||(v[2]=[Ne("",-1)])]),_:1})])]),C("div",{class:"chat-messages",ref_key:"messagesContainer",ref:l},[u.value?(U(),X("div",Zs,[A(Pt,{class:"is-loading"},{default:se(()=>[A(qt(Wr))]),_:1}),v[3]||(v[3]=Ne(" ... ",-1))])):Ve("",!0),(U(!0),X(Re,null,Bt(a.value,O=>(U(),X("div",{key:O.id,class:Ht(["message-item",{"message-self":O.isSelf}])},[A(S,{size:36,src:O.isSelf?p.value:o.value.otherUserAvatar||Me},null,8,["src"]),C("div",ea,[C("div",ta,[O.type===1?(U(),X(Re,{key:0},[Ne(Q(O.content),1)],64)):(U(),ze(kr,{key:1,src:O.content,fit:"cover",style:{"max-width":"200px"}},null,8,["src"]))]),C("div",na,Q($(O.createTime)),1)])],2))),128))],512),C("div",ra,[A(Rr,{modelValue:c.value,"onUpdate:modelValue":v[0]||(v[0]=O=>c.value=O),type:"textarea",rows:3,placeholder:"...",onKeydown:Pr(Dr(x,["exact","prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),C("div",ia,[A(Nr,{"show-file-list":!1,"before-upload":T,accept:"image/*"},{default:se(()=>[A(Ge,{type:"primary",link:""},{default:se(()=>[A(Pt,null,{default:se(()=>[A(qt(Fr))]),_:1})]),_:1})]),_:1}),A(Ge,{type:"primary",onClick:x,disabled:!c.value.trim()},{default:se(()=>[...v[4]||(v[4]=[Ne("  ",-1)])]),_:1},8,["disabled"])])])],64)):(U(),X("div",oa,[A(oe,{description:""})]))])])}}},ha=Ur(sa,[["__scopeId","data-v-39809744"]]);export{ha as default};
