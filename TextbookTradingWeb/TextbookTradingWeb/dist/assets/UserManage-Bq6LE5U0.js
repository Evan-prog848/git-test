import{b as le,u as ae,c as te,r as se,d as oe}from"./admin-B7OQe_Oy.js";import{_ as ne,o as de,b as C,c as P,e as l,w as a,r,i as b,K as A,J as re,l as d,I as ue,f as ie,t as u,d as o,n as me,g as pe,P as U,Z as ce}from"./index-Bc-dwE5O.js";import"./request-bgZeUyhp.js";import"./auth-BBsyecEI.js";const _e={class:"user-manage"},fe={class:"card-header"},ve={class:"pagination"},be={key:0,class:"user-detail"},ge={class:"detail-header"},Ve={class:"detail-info"},we={class:"username"},ye={class:"detail-stats"},he={class:"stat-item"},ke={class:"stat-value"},Ce={class:"stat-item"},Ue={class:"stat-value"},xe={class:"stat-item"},ze={class:"stat-value"},Ne={class:"stat-item"},Se={class:"stat-value"},$e={class:"stat-item"},De={class:"stat-value"},Re={__name:"UserManage",setup(Be){const h=b(!1),x=b(0),z=b([]),V=b(!1),g=b(!1),n=b(null),N=b(null),m=A({username:"",nickname:"",password:"",phone:"",school:"",status:1}),E={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在3-20个字符",trigger:"blur"}]},i=A({pageNum:1,pageSize:10,username:"",school:"",status:void 0}),w=async()=>{h.value=!0;try{const s=await le(i);z.value=s.data.records,x.value=s.data.total}catch{}finally{h.value=!1}},S=()=>{i.pageNum=1,w()},T=()=>{i.username="",i.school="",i.status=void 0,S()},j=async s=>{try{await ae(s.id,s.status);const e=s.status===1?"启用":"禁用";U.success(`${s.username} 已${e}`)}catch{s.status=s.status===1?0:1}},L=s=>s==null||Number.isNaN(Number(s))?"0%":`${Number(s).toFixed(1)}%`,q=async s=>{try{const e=await te(s.id);n.value=e.data,V.value=!0}catch(e){console.error("Failed to fetch user detail:",e)}},G=()=>{Object.assign(m,{username:"",nickname:"",password:"",phone:"",school:"",status:1}),g.value=!0},J=async()=>{if(await N.value.validate().catch(()=>!1))try{await oe(m),U.success("添加成功"),g.value=!1,w()}catch(e){console.error("Add user failed:",e)}},K=s=>{ce.confirm(`确定要重置用户 ${s.username} 的密码吗？重置后密码为 123456`,"警告",{type:"warning"}).then(async()=>{try{await se(s.id),U.success("密码已重置为 123456")}catch(e){console.error("Reset password failed:",e)}})},O=s=>{const e=s??100;return e>=70?"credit-good":e>=50?"credit-warning":"credit-danger"};return de(w),(s,e)=>{const v=r("el-input"),p=r("el-form-item"),$=r("el-option"),Q=r("el-select"),_=r("el-button"),D=r("el-form"),R=r("el-card"),c=r("el-table-column"),B=r("el-avatar"),k=r("el-tag"),Z=r("el-switch"),H=r("el-table"),W=r("el-pagination"),F=r("el-radio"),X=r("el-radio-group"),M=r("el-dialog"),I=r("el-divider"),f=r("el-descriptions-item"),Y=r("el-descriptions"),ee=re("loading");return C(),P("div",_e,[l(R,{shadow:"never",class:"search-card"},{default:a(()=>[l(D,{inline:!0,model:i},{default:a(()=>[l(p,{label:"用户名"},{default:a(()=>[l(v,{modelValue:i.username,"onUpdate:modelValue":e[0]||(e[0]=t=>i.username=t),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),l(p,{label:"学校"},{default:a(()=>[l(v,{modelValue:i.school,"onUpdate:modelValue":e[1]||(e[1]=t=>i.school=t),placeholder:"请输入学校",clearable:""},null,8,["modelValue"])]),_:1}),l(p,{label:"状态"},{default:a(()=>[l(Q,{modelValue:i.status,"onUpdate:modelValue":e[2]||(e[2]=t=>i.status=t),placeholder:"全部",clearable:"",style:{width:"120px"}},{default:a(()=>[l($,{label:"正常",value:1}),l($,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),l(p,null,{default:a(()=>[l(_,{type:"primary",onClick:S},{default:a(()=>[...e[15]||(e[15]=[d("查询",-1)])]),_:1}),l(_,{onClick:T},{default:a(()=>[...e[16]||(e[16]=[d("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(R,{shadow:"never",class:"table-card"},{header:a(()=>[o("div",fe,[e[18]||(e[18]=o("span",null,"用户列表",-1)),l(_,{type:"primary",onClick:G},{default:a(()=>[...e[17]||(e[17]=[d("新增用户",-1)])]),_:1})])]),default:a(()=>[ue((C(),ie(H,{data:z.value,style:{width:"100%"}},{default:a(()=>[l(c,{prop:"id",label:"ID",width:"80"}),l(c,{label:"头像",width:"80"},{default:a(t=>[l(B,{size:40,src:t.row.avatar},null,8,["src"])]),_:1}),l(c,{prop:"username",label:"用户名",width:"120"}),l(c,{prop:"nickname",label:"昵称",width:"120"}),l(c,{prop:"school",label:"学校",width:"180"}),l(c,{label:"认证状态",width:"100"},{default:a(t=>[l(k,{type:t.row.isVerified?"success":"info"},{default:a(()=>[d(u(t.row.isVerified?"已认证":"未认证"),1)]),_:2},1032,["type"])]),_:1}),l(c,{label:"账号状态",width:"100"},{default:a(t=>[l(Z,{modelValue:t.row.status,"onUpdate:modelValue":y=>t.row.status=y,"active-value":1,"inactive-value":0,onChange:y=>j(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(c,{label:"信用积分",width:"100"},{default:a(t=>[o("span",{class:me(O(t.row.creditScore))},u(t.row.creditScore??100),3)]),_:1}),l(c,{prop:"createTime",label:"注册时间",width:"180"}),l(c,{label:"操作"},{default:a(t=>[l(_,{size:"small",link:"",onClick:y=>q(t.row)},{default:a(()=>[...e[19]||(e[19]=[d("详情",-1)])]),_:1},8,["onClick"]),l(_,{size:"small",type:"danger",link:"",onClick:y=>K(t.row)},{default:a(()=>[...e[20]||(e[20]=[d("重置密码",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,h.value]]),o("div",ve,[l(W,{"current-page":i.pageNum,"onUpdate:currentPage":e[3]||(e[3]=t=>i.pageNum=t),"page-size":i.pageSize,"onUpdate:pageSize":e[4]||(e[4]=t=>i.pageSize=t),total:x.value,layout:"total, prev, pager, next, jumper",onCurrentChange:w},null,8,["current-page","page-size","total"])])]),_:1}),l(M,{modelValue:g.value,"onUpdate:modelValue":e[12]||(e[12]=t=>g.value=t),title:"新增用户",width:"500px"},{footer:a(()=>[l(_,{onClick:e[11]||(e[11]=t=>g.value=!1)},{default:a(()=>[...e[23]||(e[23]=[d("取消",-1)])]),_:1}),l(_,{type:"primary",onClick:J},{default:a(()=>[...e[24]||(e[24]=[d("确定",-1)])]),_:1})]),default:a(()=>[l(D,{model:m,rules:E,ref_key:"addFormRef",ref:N,"label-width":"80px"},{default:a(()=>[l(p,{label:"用户名",prop:"username"},{default:a(()=>[l(v,{modelValue:m.username,"onUpdate:modelValue":e[5]||(e[5]=t=>m.username=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(p,{label:"昵称"},{default:a(()=>[l(v,{modelValue:m.nickname,"onUpdate:modelValue":e[6]||(e[6]=t=>m.nickname=t),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),l(p,{label:"密码",prop:"password"},{default:a(()=>[l(v,{modelValue:m.password,"onUpdate:modelValue":e[7]||(e[7]=t=>m.password=t),type:"password",placeholder:"请输入密码，默认123456","show-password":""},null,8,["modelValue"])]),_:1}),l(p,{label:"手机号"},{default:a(()=>[l(v,{modelValue:m.phone,"onUpdate:modelValue":e[8]||(e[8]=t=>m.phone=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(p,{label:"学校"},{default:a(()=>[l(v,{modelValue:m.school,"onUpdate:modelValue":e[9]||(e[9]=t=>m.school=t),placeholder:"请输入学校"},null,8,["modelValue"])]),_:1}),l(p,{label:"状态"},{default:a(()=>[l(X,{modelValue:m.status,"onUpdate:modelValue":e[10]||(e[10]=t=>m.status=t)},{default:a(()=>[l(F,{label:1},{default:a(()=>[...e[21]||(e[21]=[d("正常",-1)])]),_:1}),l(F,{label:0},{default:a(()=>[...e[22]||(e[22]=[d("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(M,{modelValue:V.value,"onUpdate:modelValue":e[14]||(e[14]=t=>V.value=t),title:"用户详情",width:"600px"},{footer:a(()=>[l(_,{onClick:e[13]||(e[13]=t=>V.value=!1)},{default:a(()=>[...e[30]||(e[30]=[d("关闭",-1)])]),_:1})]),default:a(()=>[n.value?(C(),P("div",be,[o("div",ge,[l(B,{size:80,src:n.value.avatar},null,8,["src"]),o("div",Ve,[o("h3",null,u(n.value.nickname||n.value.username),1),o("p",we,"@"+u(n.value.username),1),l(k,{type:n.value.isVerified?"success":"info",size:"small"},{default:a(()=>[d(u(n.value.isVerified?"已认证":"未认证"),1)]),_:1},8,["type"]),l(k,{type:n.value.status===1?"success":"danger",size:"small",style:{"margin-left":"8px"}},{default:a(()=>[d(u(n.value.status===1?"正常":"禁用"),1)]),_:1},8,["type"])])]),l(I),l(Y,{column:2,border:""},{default:a(()=>[l(f,{label:"用户ID"},{default:a(()=>[d(u(n.value.id),1)]),_:1}),l(f,{label:"用户名"},{default:a(()=>[d(u(n.value.username),1)]),_:1}),l(f,{label:"昵称"},{default:a(()=>[d(u(n.value.nickname||"-"),1)]),_:1}),l(f,{label:"手机号"},{default:a(()=>[d(u(n.value.phone||"-"),1)]),_:1}),l(f,{label:"邮箱"},{default:a(()=>[d(u(n.value.email||"-"),1)]),_:1}),l(f,{label:"学校"},{default:a(()=>[d(u(n.value.school||"-"),1)]),_:1}),l(f,{label:"学院"},{default:a(()=>[d(u(n.value.college||"-"),1)]),_:1}),l(f,{label:"注册时间"},{default:a(()=>[d(u(n.value.createTime),1)]),_:1})]),_:1}),l(I),o("div",ye,[o("div",he,[o("div",ke,u(n.value.textbookCount||0),1),e[25]||(e[25]=o("div",{class:"stat-label"},"发布教材",-1))]),o("div",Ce,[o("div",Ue,u(n.value.orderCount||0),1),e[26]||(e[26]=o("div",{class:"stat-label"},"交易订单",-1))]),o("div",xe,[o("div",ze,u(n.value.favoriteCount||0),1),e[27]||(e[27]=o("div",{class:"stat-label"},"收藏数",-1))]),o("div",Ne,[o("div",Se,u(n.value.followCount||0),1),e[28]||(e[28]=o("div",{class:"stat-label"},"关注数",-1))]),o("div",$e,[o("div",De,u(L(n.value.goodRate)),1),e[29]||(e[29]=o("div",{class:"stat-label"},"好评率",-1))])])])):pe("",!0)]),_:1},8,["modelValue"])])}}},Ae=ne(Re,[["__scopeId","data-v-39219e12"]]);export{Ae as default};
