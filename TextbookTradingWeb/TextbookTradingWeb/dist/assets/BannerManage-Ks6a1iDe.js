import{_ as J,o as K,b as _,c as P,e as l,w as t,r as s,i as p,J as S,I as W,f as y,l as m,d as g,u as Z,U as G,P as d,Z as H,K as Q}from"./index-Bc-dwE5O.js";import{s as X,t as B,v as Y,w as ee}from"./admin-B7OQe_Oy.js";import{s as le}from"./request-bgZeUyhp.js";import"./auth-BBsyecEI.js";const te={class:"banner-manage"},ae={class:"card-header"},oe={class:"upload-container"},ne={__name:"BannerManage",setup(se){const v=p(!1),k=p([]),u=p(!1),b=p(""),V=p(null),n=Q({id:null,title:"",imageUrl:"",link:"",sort:0,status:1}),C={title:[{required:!0,message:"请输入标题",trigger:"blur"}],imageUrl:[{required:!0,message:"请上传图片",trigger:"change"}]},x=a=>{const e=a.type.startsWith("image/"),r=a.size/1024/1024<5;return e?r?!0:(d.error("图片大小不能超过 5MB!"),!1):(d.error("只能上传图片文件!"),!1)},M=async a=>{const e=new FormData;e.append("file",a.file),e.append("type","banner");try{const r=await le.post("/file/upload",e,{headers:{"Content-Type":"multipart/form-data"}});n.imageUrl=r.data,d.success("上传成功")}catch{d.error("上传失败")}},w=async()=>{v.value=!0;try{const a=await X();k.value=a.data}catch{}finally{v.value=!1}},D=()=>{b.value="新增轮播图",Object.assign(n,{id:null,title:"",imageUrl:"",link:"",sort:0,status:1}),u.value=!0},E=a=>{b.value="编辑轮播图",Object.assign(n,a),u.value=!0},I=a=>{H.confirm("确定要删除这张轮播图吗？","提示",{type:"warning"}).then(async()=>{await Y(a.id),d.success("删除成功"),w()})},$=async a=>{try{await B(a),d.success("状态已更新")}catch{a.status=a.status===1?0:1}},q=()=>{V.value.validate(async a=>{a&&(n.id?await B(n):await ee(n),d.success("保存成功"),u.value=!1,w())})};return K(w),(a,e)=>{const r=s("el-button"),i=s("el-table-column"),h=s("el-image"),z=s("el-switch"),L=s("el-table"),N=s("el-card"),U=s("el-input"),c=s("el-form-item"),T=s("el-icon"),j=s("el-upload"),F=s("el-input-number"),O=s("el-form"),R=s("el-dialog"),A=S("loading");return _(),P("div",te,[l(N,{shadow:"never"},{header:t(()=>[g("div",ae,[e[6]||(e[6]=g("span",null,"轮播图管理",-1)),l(r,{type:"primary",onClick:D},{default:t(()=>[...e[5]||(e[5]=[m("新增轮播图",-1)])]),_:1})])]),default:t(()=>[W((_(),y(L,{data:k.value,style:{width:"100%"}},{default:t(()=>[l(i,{prop:"id",label:"ID",width:"80"}),l(i,{label:"图片",width:"200"},{default:t(o=>[l(h,{src:o.row.imageUrl,style:{width:"160px",height:"60px"},fit:"cover"},null,8,["src"])]),_:1}),l(i,{prop:"title",label:"标题"}),l(i,{prop:"link",label:"链接"}),l(i,{prop:"sort",label:"排序",width:"80"}),l(i,{label:"状态",width:"100"},{default:t(o=>[l(z,{modelValue:o.row.status,"onUpdate:modelValue":f=>o.row.status=f,"active-value":1,"inactive-value":0,onChange:f=>$(o.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(i,{label:"操作",width:"150"},{default:t(o=>[l(r,{size:"small",link:"",onClick:f=>E(o.row)},{default:t(()=>[...e[7]||(e[7]=[m("编辑",-1)])]),_:1},8,["onClick"]),l(r,{size:"small",type:"danger",link:"",onClick:f=>I(o.row)},{default:t(()=>[...e[8]||(e[8]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[A,v.value]])]),_:1}),l(R,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=o=>u.value=o),title:b.value,width:"500px"},{footer:t(()=>[l(r,{onClick:e[3]||(e[3]=o=>u.value=!1)},{default:t(()=>[...e[10]||(e[10]=[m("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:q},{default:t(()=>[...e[11]||(e[11]=[m("确定",-1)])]),_:1})]),default:t(()=>[l(O,{model:n,rules:C,ref_key:"formRef",ref:V,"label-width":"80px"},{default:t(()=>[l(c,{label:"标题",prop:"title"},{default:t(()=>[l(U,{modelValue:n.title,"onUpdate:modelValue":e[0]||(e[0]=o=>n.title=o),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),l(c,{label:"图片",prop:"imageUrl"},{default:t(()=>[g("div",oe,[l(j,{class:"banner-uploader","show-file-list":!1,"before-upload":x,"http-request":M,accept:"image/*"},{default:t(()=>[n.imageUrl?(_(),y(h,{key:0,src:n.imageUrl,class:"banner-preview",fit:"cover"},null,8,["src"])):(_(),y(T,{key:1,class:"upload-icon"},{default:t(()=>[l(Z(G))]),_:1}))]),_:1}),e[9]||(e[9]=g("div",{class:"upload-tip"},"点击上传图片，建议尺寸 1200x400",-1))])]),_:1}),l(c,{label:"链接",prop:"link"},{default:t(()=>[l(U,{modelValue:n.link,"onUpdate:modelValue":e[1]||(e[1]=o=>n.link=o),placeholder:"请输入点击跳转链接"},null,8,["modelValue"])]),_:1}),l(c,{label:"排序"},{default:t(()=>[l(F,{modelValue:n.sort,"onUpdate:modelValue":e[2]||(e[2]=o=>n.sort=o),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},pe=J(ne,[["__scopeId","data-v-76d0f64e"]]);export{pe as default};
