import{x as L,y as O,z as S,A as F,B as J,C as P,D as Z}from"./admin-B7OQe_Oy.js";import{_ as G,o as H,b as N,c as Q,e as l,w as t,r as s,i as r,J as W,I as X,f as Y,l as i,d as M,Z as ee,P as w,K as le}from"./index-Bc-dwE5O.js";import"./request-bgZeUyhp.js";import"./auth-BBsyecEI.js";const te={class:"role-manage"},ae={class:"card-header"},oe={__name:"RoleManage",setup(ne){const f=r(!1),k=r([]),m=r(!1),u=r(!1),v=r(""),C=r(null),p=r(null),V=r(null),_=r([]),n=le({id:null,roleName:"",roleCode:"",description:""}),h={roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],roleCode:[{required:!0,message:"请输入角色编码",trigger:"blur"}]},g=async()=>{f.value=!0;try{const a=await L({pageNum:1,pageSize:100});k.value=a.data.records}catch{}finally{f.value=!1}},B=async()=>{try{const a=await Z();_.value=a.data}catch{}},D=()=>{v.value="新增角色",Object.assign(n,{id:null,roleName:"",roleCode:"",description:""}),u.value=!0},z=a=>{v.value="编辑角色",Object.assign(n,a),u.value=!0},I=async()=>{if(await V.value.validate().catch(()=>!1))try{n.id?await F(n):await J(n),w.success("保存成功"),u.value=!1,g()}catch(e){console.error("Save failed:",e)}},U=a=>{ee.confirm("确定要删除该角色吗？","提示",{type:"warning"}).then(async()=>{await S(a.id),w.success("删除成功"),g()})},$=async a=>{C.value=a.id,m.value=!0,_.value.length===0&&await B();try{const e=await O(a.id);p.value&&p.value.setCheckedKeys(e.data)}catch{}},A=async()=>{const a=p.value.getCheckedKeys();try{await P(C.value,a),w.success("权限分配成功"),m.value=!1}catch{}};return H(g),(a,e)=>{const d=s("el-button"),c=s("el-table-column"),E=s("el-table"),K=s("el-card"),y=s("el-input"),b=s("el-form-item"),T=s("el-form"),R=s("el-dialog"),j=s("el-tree"),q=W("loading");return N(),Q("div",te,[l(K,{shadow:"never"},{header:t(()=>[M("div",ae,[e[8]||(e[8]=M("span",null,"角色管理",-1)),l(d,{type:"primary",onClick:D},{default:t(()=>[...e[7]||(e[7]=[i("新增角色",-1)])]),_:1})])]),default:t(()=>[X((N(),Y(E,{data:k.value},{default:t(()=>[l(c,{prop:"id",label:"ID",width:"80"}),l(c,{prop:"roleName",label:"角色名称"}),l(c,{prop:"roleCode",label:"角色编码"}),l(c,{prop:"description",label:"描述"}),l(c,{label:"操作",width:"220"},{default:t(o=>[l(d,{size:"small",link:"",onClick:x=>z(o.row)},{default:t(()=>[...e[9]||(e[9]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(d,{size:"small",type:"warning",link:"",onClick:x=>$(o.row)},{default:t(()=>[...e[10]||(e[10]=[i("分配权限",-1)])]),_:1},8,["onClick"]),l(d,{size:"small",type:"danger",link:"",onClick:x=>U(o.row)},{default:t(()=>[...e[11]||(e[11]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[q,f.value]])]),_:1}),l(R,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=o=>u.value=o),title:v.value,width:"500px"},{footer:t(()=>[l(d,{onClick:e[3]||(e[3]=o=>u.value=!1)},{default:t(()=>[...e[12]||(e[12]=[i("取消",-1)])]),_:1}),l(d,{type:"primary",onClick:I},{default:t(()=>[...e[13]||(e[13]=[i("确定",-1)])]),_:1})]),default:t(()=>[l(T,{model:n,rules:h,ref_key:"formRef",ref:V,"label-width":"100px"},{default:t(()=>[l(b,{label:"角色名称",prop:"roleName"},{default:t(()=>[l(y,{modelValue:n.roleName,"onUpdate:modelValue":e[0]||(e[0]=o=>n.roleName=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),l(b,{label:"角色编码",prop:"roleCode"},{default:t(()=>[l(y,{modelValue:n.roleCode,"onUpdate:modelValue":e[1]||(e[1]=o=>n.roleCode=o),placeholder:"请输入角色编码"},null,8,["modelValue"])]),_:1}),l(b,{label:"描述"},{default:t(()=>[l(y,{modelValue:n.description,"onUpdate:modelValue":e[2]||(e[2]=o=>n.description=o),type:"textarea",rows:3,placeholder:"请输入角色描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(R,{modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=o=>m.value=o),title:"分配权限",width:"400px"},{footer:t(()=>[l(d,{onClick:e[5]||(e[5]=o=>m.value=!1)},{default:t(()=>[...e[14]||(e[14]=[i("取消",-1)])]),_:1}),l(d,{type:"primary",onClick:A},{default:t(()=>[...e[15]||(e[15]=[i("确定",-1)])]),_:1})]),default:t(()=>[l(j,{ref_key:"treeRef",ref:p,data:_.value,"show-checkbox":"","node-key":"id",props:{label:"menuName",children:"children"}},null,8,["data"])]),_:1},8,["modelValue"])])}}},ue=G(oe,[["__scopeId","data-v-f2cbe039"]]);export{ue as default};
