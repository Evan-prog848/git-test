import{g as R,k as j,l as q,m as A}from"./admin-B7OQe_Oy.js";import{_ as J,o as K,b as V,c as O,e as t,w as o,r as s,i as r,J as Z,I as G,f as H,l as m,d as y,O as Q,Z as W,P as k,K as X}from"./index-Bc-dwE5O.js";import"./request-bgZeUyhp.js";import"./auth-BBsyecEI.js";const Y={class:"category-manage"},ee={class:"card-header"},te={class:"pagination"},ae={__name:"CategoryManage",setup(le){const f=r(!1),g=r([]),i=r(!1),p=r(1),c=r(10),b=r(0),v=r(""),C=r(null),l=X({id:null,name:"",sort:0}),x={name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},_=async()=>{f.value=!0;try{const a=await R();g.value=a.data||[],b.value=g.value.length}catch(a){console.error("Failed to fetch categories:",a)}finally{f.value=!1}},z=Q(()=>{const a=(p.value-1)*c.value,e=a+c.value;return g.value.slice(a,e)}),h=a=>{p.value=a},B=()=>{v.value="新增分类",l.id=null,l.name="",l.sort=0,i.value=!0},D=a=>{v.value="编辑分类",l.id=a.id,l.name=a.name,l.sort=a.sort,i.value=!0},M=async a=>{try{await W.confirm("确定要删除该分类吗？","提示",{type:"warning"}),await j(a.id),k.success("删除成功"),_()}catch(e){e!=="cancel"&&console.error("Delete failed:",e)}},U=async()=>{if(await C.value.validate().catch(()=>!1))try{l.id?await q(l):await A(l),k.success("保存成功"),i.value=!1,_()}catch(e){console.error("Save failed:",e)}};return K(_),(a,e)=>{const d=s("el-button"),u=s("el-table-column"),E=s("el-table"),N=s("el-pagination"),I=s("el-card"),L=s("el-input"),w=s("el-form-item"),P=s("el-input-number"),S=s("el-form"),T=s("el-dialog"),$=Z("loading");return V(),O("div",Y,[t(I,{shadow:"never"},{header:o(()=>[y("div",ee,[e[7]||(e[7]=y("span",null,"分类管理",-1)),t(d,{type:"primary",onClick:B},{default:o(()=>[...e[6]||(e[6]=[m("新增分类",-1)])]),_:1})])]),default:o(()=>[G((V(),H(E,{data:z.value,style:{width:"100%"}},{default:o(()=>[t(u,{prop:"id",label:"ID",width:"80"}),t(u,{prop:"name",label:"分类名称"}),t(u,{prop:"sort",label:"排序",width:"100"}),t(u,{prop:"createTime",label:"创建时间"}),t(u,{label:"操作",width:"150"},{default:o(n=>[t(d,{size:"small",onClick:F=>D(n.row)},{default:o(()=>[...e[8]||(e[8]=[m("编辑",-1)])]),_:1},8,["onClick"]),t(d,{size:"small",type:"danger",onClick:F=>M(n.row)},{default:o(()=>[...e[9]||(e[9]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[$,f.value]]),y("div",te,[t(N,{"current-page":p.value,"onUpdate:currentPage":e[0]||(e[0]=n=>p.value=n),"page-size":c.value,"onUpdate:pageSize":e[1]||(e[1]=n=>c.value=n),total:b.value,layout:"total, prev, pager, next, jumper",onCurrentChange:h},null,8,["current-page","page-size","total"])])]),_:1}),t(T,{modelValue:i.value,"onUpdate:modelValue":e[5]||(e[5]=n=>i.value=n),title:v.value,width:"400px"},{footer:o(()=>[t(d,{onClick:e[4]||(e[4]=n=>i.value=!1)},{default:o(()=>[...e[10]||(e[10]=[m("取消",-1)])]),_:1}),t(d,{type:"primary",onClick:U},{default:o(()=>[...e[11]||(e[11]=[m("确定",-1)])]),_:1})]),default:o(()=>[t(S,{model:l,rules:x,ref_key:"formRef",ref:C,"label-width":"80px"},{default:o(()=>[t(w,{label:"名称",prop:"name"},{default:o(()=>[t(L,{modelValue:l.name,"onUpdate:modelValue":e[2]||(e[2]=n=>l.name=n),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),t(w,{label:"排序",prop:"sort"},{default:o(()=>[t(P,{modelValue:l.sort,"onUpdate:modelValue":e[3]||(e[3]=n=>l.sort=n),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ie=J(ae,[["__scopeId","data-v-3f8829ce"]]);export{ie as default};
