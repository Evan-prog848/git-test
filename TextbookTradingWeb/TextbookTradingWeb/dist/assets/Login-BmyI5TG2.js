import{_ as L,b as T,c as $,d as s,e as t,w as a,r as l,j as B,L as C,u as g,k as N,V as q,W as z,l as d,i as _,K as E,P as w}from"./index-Bc-dwE5O.js";import{u as F}from"./user-BS79HK15.js";import{l as M,b as j}from"./user-nO6ITqrd.js";import{a as x}from"./request-bgZeUyhp.js";import"./auth-BBsyecEI.js";const A={class:"login-container"},J={class:"login-box"},K={class:"login-header"},O={class:"logo"},P={class:"form-options"},W={class:"form-footer"},h={__name:"Login",setup(D){const k=B(),V=C(),v=F(),b=_(null),m=_(!1),y=_(!1),n=E({username:"",password:""}),I={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},R=async()=>{b.value.validate(async p=>{var e;if(p){m.value=!0;const u="/api";try{const o=await x.post(`${u}/admin/login`,n);if(o.data&&o.data.code===200&&((e=o.data.data)!=null&&e.token)){localStorage.setItem("adminToken",o.data.data.token),localStorage.setItem("token",o.data.data.token);const r=await x.get(`${u}/admin/info`,{headers:{Authorization:`Bearer ${o.data.data.token}`}});localStorage.setItem("adminInfo",JSON.stringify(r.data.data)),w.success("管理员登录成功"),k.push("/admin/dashboard");return}}catch{}try{const o=await M(n);v.setToken(o.data.token);const r=await j();v.setUserInfo(r.data),w.success("登录成功");const f=V.query.redirect||"/";k.push(f)}catch{}finally{m.value=!1}}})};return(p,e)=>{const u=l("el-icon"),o=l("el-input"),r=l("el-form-item"),f=l("el-checkbox"),c=l("el-button"),S=l("el-form"),U=l("el-card");return T(),$("div",A,[s("div",J,[s("div",K,[s("div",O,[t(u,{size:40,color:"#2b9a6e"},{default:a(()=>[t(g(N))]),_:1}),e[4]||(e[4]=s("span",{class:"title"},"二手教材交易系统",-1))]),e[5]||(e[5]=s("p",{class:"subtitle"},"让知识传递，让书籍循环",-1))]),t(U,{class:"login-card",shadow:"hover"},{default:a(()=>[e[11]||(e[11]=s("h2",{class:"form-title"},"欢迎登录",-1)),t(S,{model:n,rules:I,ref_key:"loginFormRef",ref:b,size:"large",class:"login-form"},{default:a(()=>[t(r,{prop:"username"},{default:a(()=>[t(o,{modelValue:n.username,"onUpdate:modelValue":e[0]||(e[0]=i=>n.username=i),placeholder:"请输入用户名","prefix-icon":g(q)},null,8,["modelValue","prefix-icon"])]),_:1}),t(r,{prop:"password"},{default:a(()=>[t(o,{modelValue:n.password,"onUpdate:modelValue":e[1]||(e[1]=i=>n.password=i),type:"password",placeholder:"请输入密码","prefix-icon":g(z),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),s("div",P,[t(f,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=i=>y.value=i)},{default:a(()=>[...e[6]||(e[6]=[d("记住我",-1)])]),_:1},8,["modelValue"]),t(c,{link:"",type:"primary"},{default:a(()=>[...e[7]||(e[7]=[d("忘记密码？",-1)])]),_:1})]),t(r,null,{default:a(()=>[t(c,{type:"primary",class:"submit-btn",loading:m.value,onClick:R},{default:a(()=>[...e[8]||(e[8]=[d(" 立即登录 ",-1)])]),_:1},8,["loading"])]),_:1}),s("div",W,[e[10]||(e[10]=d(" 还没有账号？ ",-1)),t(c,{link:"",type:"primary",onClick:e[3]||(e[3]=i=>p.$router.push("/register"))},{default:a(()=>[...e[9]||(e[9]=[d("立即注册",-1)])]),_:1})])]),_:1},8,["model"])]),_:1}),e[12]||(e[12]=s("div",{class:"page-footer"},[s("p",null,"© 2025 Textbook Trading System")],-1))])])}}},Z=L(h,[["__scopeId","data-v-b98331c7"]]);export{Z as default};
